{
  "name": "ãƒ›ã‚²ãƒ¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  LINE Bot ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç‰ˆ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 3 * * 0"
            }
          ]
        }
      },
      "id": "cron-weekly-learn",
      "name": "å®šæœŸå­¦ç¿’ãƒˆãƒªã‚¬ãƒ¼",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 900],
      "notes": "æ¯é€±æ—¥æ›œ 3:00 AM ã«è‡ªå‹•å­¦ç¿’å®Ÿè¡Œ"
    },
    {
      "parameters": {
        "path": "hogey-bot",
        "options": {}
      },
      "id": "webhook-line",
      "name": "LINE Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "functionCode": "const event = $input.item.json.events[0];\nconst text = event.message?.text || '';\nconst userId = event.source.userId;\nconst replyToken = event.replyToken;\nconst postbackData = event.postback?.data || '';\n\nlet result = {\n  userId: userId,\n  replyToken: replyToken,\n  text: text,\n  postbackData: postbackData,\n  eventType: event.type\n};\n\n// ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒãƒ³ãƒ‰åˆ¤å®š\nif (text.startsWith('menu:')) {\n  const menuAction = text.split(':')[1];\n  result.menuAction = menuAction;\n  result.needsState = true;\n} \n// ãƒã‚¹ãƒˆãƒãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ\nelse if (event.type === 'postback') {\n  const params = new URLSearchParams(postbackData);\n  result.action = params.get('action');\n  result.index = parseInt(params.get('index'));\n  result.needsState = true;\n}\n// é€šå¸¸ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆçŠ¶æ…‹ä¾å­˜ï¼‰\nelse {\n  result.needsState = true;\n}\n\nreturn { json: result };"
      },
      "id": "parse-command",
      "name": "ã‚³ãƒãƒ³ãƒ‰è§£æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "serviceAccountEmail": "{{ $credentials.googleServiceAccount.email }}",
        "sheetId": "YOUR_SHEET_ID",
        "range": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ç®¡ç†!A:G",
        "options": {}
      },
      "id": "get-user-state",
      "name": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹å–å¾—",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [650, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
  "functionCode": "const userId = $input.item.json.userId;\nconst menuAction = $input.item.json.menuAction;\nconst text = $input.item.json.text;\nconst action = $input.item.json.action;\nconst eventType = $input.item.json.eventType;\n\n// Google Sheetsã‹ã‚‰å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹\nconst stateRows = $node['ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹å–å¾—'].json.values || [];\nconst userRow = stateRows.find(row => row[0] === userId);\n\nlet userState = {\n  userId: userId,\n  state: 'idle',\n  count: null,\n  theme: null,\n  type: null,\n  posts_data: null,\n  current_index: 0\n};\n\nif (userRow) {\n  userState = {\n    userId: userRow[0],\n    state: userRow[1] || 'idle',\n    count: userRow[2] ? parseInt(userRow[2]) : null,\n    theme: userRow[3] || null,\n    posts_data: userRow[4] || null,\n    current_index: userRow[5] ? parseInt(userRow[5]) : 0,\n    type: userRow[7] || null\n  };\n}\n\nlet result = {\n  userId: userId,\n  replyToken: $input.item.json.replyToken,\n  currentState: userState,\n  nextAction: null,\n  updateState: null\n};\n\n// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†\nif (menuAction) {\n  switch(menuAction) {\n    case 'generate':\n      result.nextAction = 'show_count_selection';\n      result.updateState = { state: 'selecting_count', type: 'buzz' };\n      break;\n      \n    case 'trilogy':\n      result.nextAction = 'show_theme_selection';\n      result.updateState = { state: 'selecting_theme', type: 'trilogy', count: 3 };\n      break;\n      \n    case 'today':\n      // 7ã‚«ãƒ†ã‚´ãƒªã«åŒæœŸ\n      const cats = ['ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ãƒ»é‡‘', 'ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚­ãƒ£ãƒªã‚¢', 'ç”Ÿæ´»ãƒ»ç¯€ç´„', 'ç¤¾ä¼šãƒ»ãƒãƒƒãƒˆè£äº‹æƒ…', 'å¥åº·ãƒ»ç¾å®¹', 'æ‹æ„›ãƒ»äººé–“é–¢ä¿‚', 'è¶£å‘³ãƒ»éŠã³'];\n      const todayTheme = cats[new Date().getDay()];\n      result.nextAction = 'show_count_selection';\n      result.updateState = { state: 'selecting_count', type: 'today', theme: todayTheme };\n      result.todayTheme = todayTheme;\n      break;\n      \n    case 'learn':\n      result.nextAction = 'show_learn_confirm';\n      break;\n      \n    case 'status':\n      result.nextAction = 'show_status';\n      break;\n      \n    case 'help':\n      result.nextAction = 'show_help';\n      break;\n  }\n}\n// ãƒã‚¹ãƒˆãƒãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†\nelse if (action) {\n  const posts = userState.posts_data ? JSON.parse(userState.posts_data) : [];\n  const index = $input.item.json.index;\n  \n  switch(action) {\n    case 'post':\n      result.nextAction = 'post_to_x';\n      result.postContent = posts[index];\n      result.updateState = { state: 'idle', posts_data: null, current_index: 0 };\n      break;\n      \n    case 'save':\n      result.nextAction = 'save_to_sheets';\n      result.postContent = posts[index];\n      break;\n      \n    case 'next':\n      const nextIndex = index >= posts.length ? 0 : index;\n      result.nextAction = 'show_post';\n      result.postContent = posts[nextIndex];\n      result.postIndex = nextIndex;\n      result.totalPosts = posts.length;\n      result.updateState = { current_index: nextIndex };\n      break;\n      \n    case 'detail':\n      result.nextAction = 'show_post_detail';\n      result.postContent = posts[index];\n      result.postIndex = index;\n      result.totalPosts = posts.length;\n      break;\n      \n    case 'learn_execute':\n      result.nextAction = 'execute_learn';\n      break;\n  }\n}\n// çŠ¶æ…‹ã«å¿œã˜ãŸãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†\nelse if (userState.state === 'selecting_count') {\n  const count = parseInt(text);\n  if (count > 0) {\n    if (userState.type === 'today') {\n      // ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒã¯æ—¢ã«è¨­å®šæ¸ˆã¿ â†’ å³ç”Ÿæˆ\n      result.nextAction = 'generate_posts';\n      result.generateParams = {\n        count: count,\n        theme: userState.theme,\n        type: userState.type\n      };\n      result.updateState = { state: 'generating', count: count };\n    } else {\n      // é€šå¸¸ãƒ•ãƒ­ãƒ¼ â†’ ãƒ†ãƒ¼ãƒé¸æŠã¸\n      result.nextAction = 'show_theme_selection';\n      result.updateState = { state: 'selecting_theme', count: count };\n    }\n  } else {\n    result.nextAction = 'error';\n    result.errorMessage = 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';\n  }\n}\nelse if (userState.state === 'selecting_theme') {\n  result.nextAction = 'generate_posts';\n  result.generateParams = {\n    count: userState.count,\n    theme: text,\n    type: userState.type || 'buzz'\n  };\n  result.updateState = { state: 'generating', theme: text };\n}\nelse {\n  result.nextAction = 'error';\n  result.errorMessage = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰æ“ä½œã‚’é¸æŠã—ã¦ãã ã•ã„';\n}\n\nreturn { json: result };"
      },
      "id": "state-machine",
      "name": "çŠ¶æ…‹åˆ¤å®š",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.nextAction }}",
              "value2": "show_count_selection"
            }
          ]
        }
      },
      "id": "switch-action-count",
      "name": "ä»¶æ•°é¸æŠè¡¨ç¤º?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1050, 200]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.nextAction }}",
              "value2": "show_theme_selection"
            }
          ]
        }
      },
      "id": "switch-action-theme",
      "name": "ãƒ†ãƒ¼ãƒé¸æŠè¡¨ç¤º?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.nextAction }}",
              "value2": "generate_posts"
            }
          ]
        }
      },
      "id": "switch-action-generate",
      "name": "æŠ•ç¨¿ç”Ÿæˆå®Ÿè¡Œ?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "functionCode": "const type = $input.item.json.currentState.type;\nconst todayTheme = $input.item.json.todayTheme;\n\nlet message = {\n  type: 'text',\n  text: 'ä½•ä»¶ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ',\n  quickReply: {\n    items: [\n      {\n        type: 'action',\n        action: { type: 'message', label: '3ä»¶', text: '3' }\n      },\n      {\n        type: 'action',\n        action: { type: 'message', label: '5ä»¶', text: '5' }\n      },\n      {\n        type: 'action',\n        action: { type: 'message', label: '10ä»¶', text: '10' }\n      },\n      {\n        type: 'action',\n        action: { type: 'message', label: '20ä»¶', text: '20' }\n      }\n    ]\n  }\n};\n\nif (type === 'today') {\n  message.text = `ğŸ“š ä»Šæ—¥ã¯ã€Œ${todayTheme}ã€ã®ãƒ†ãƒ¼ãƒã§ã™\\nä½•ä»¶ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ`;\n}\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: message,\n    userId: $input.item.json.userId,\n    updateState: $input.item.json.updateState\n  } \n};"
      },
      "id": "create-count-reply",
      "name": "ä»¶æ•°é¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 200]
    },
    {
      "parameters": {
  "functionCode": "const themes = [\n  { emoji: 'ğŸ°', name: 'ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ãƒ»é‡‘' },\n  { emoji: 'ğŸ’¼', name: 'ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚­ãƒ£ãƒªã‚¢' },\n  { emoji: 'ï¿½', name: 'ç”Ÿæ´»ãƒ»ç¯€ç´„' },\n  { emoji: 'ğŸŒ', name: 'ç¤¾ä¼šãƒ»ãƒãƒƒãƒˆè£äº‹æƒ…' },\n  { emoji: 'ï¿½', name: 'å¥åº·ãƒ»ç¾å®¹' },\n  { emoji: 'â¤ï¸', name: 'æ‹æ„›ãƒ»äººé–“é–¢ä¿‚' },\n  { emoji: 'ğŸ®', name: 'è¶£å‘³ãƒ»éŠã³' }\n];\n\nconst message = {\n  type: 'text',\n  text: 'ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§ãã ã•ã„ (7ã‚«ãƒ†ã‚´ãƒª)',\n  quickReply: {\n    items: themes.map(t => ({\n      type: 'action',\n      action: {\n        type: 'message',\n        label: `${t.emoji} ${t.name}`,\n        text: t.name\n      }\n    }))\n  }\n};\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: message,\n    userId: $input.item.json.userId,\n    updateState: $input.item.json.updateState\n  } \n};"
      },
      "id": "create-theme-reply",
      "name": "ãƒ†ãƒ¼ãƒé¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "command": "cd c:\\Repos\\note-articles\\tools && python hogey_algorithm.py --count {{ $json.generateParams.count }} --theme \"{{ $json.generateParams.theme }}\" --mode {{ $json.generateParams.type === 'trilogy' ? 'trilogy' : 'buzz' }} --output temp_{{ $json.userId }}.csv"
      },
      "id": "execute-python",
      "name": "Pythonå®Ÿè¡Œ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1250, 400]
    },
    {
      "parameters": {
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer YOUR_CHANNEL_ACCESS_TOKEN"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "replyToken",
              "value": "={{ $json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ JSON.stringify([$json.message]) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "line-reply",
      "name": "LINEè¿”ä¿¡",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "sheetId": "YOUR_SHEET_ID",
        "range": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ç®¡ç†!A:H",
        "options": {}
      },
      "id": "update-user-state",
      "name": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹æ›´æ–°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [1450, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const params = $input.item.json.generateParams;\nconst output = $node['Pythonå®Ÿè¡Œ'].json;\nconst userId = $input.item.json.userId;\nconst replyToken = $input.item.json.replyToken;\n\n// CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\nconst fs = require('fs');\nconst csvPath = `c:\\\\Repos\\\\note-articles\\\\tools\\\\temp_${userId}.csv`;\nconst csvContent = fs.readFileSync(csvPath, 'utf-8');\n\n// CSVè§£æï¼ˆç°¡æ˜“ç‰ˆï¼‰\nconst lines = csvContent.split('\\n').slice(1); // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚­ãƒƒãƒ—\nconst posts = lines\n  .filter(line => line.trim())\n  .map(line => {\n    const cols = line.split(',');\n    return {\n      text: cols[0],\n      theme: cols[1],\n      education_type: cols[2],\n      template_type: cols[3],\n      created_at: cols[4]\n    };\n  });\n\n// æœ€åˆã®æŠ•ç¨¿ã‚’è¡¨ç¤º\nconst firstPost = posts[0];\nconst progressBar = 'â–ˆ' + 'â–‘'.repeat(9);\n\nconst message = {\n  type: 'text',\n  text: `ğŸ¶ æŠ•ç¨¿1/${posts.length}\\n${progressBar}\\n\\n${firstPost.text}\\n\\nãƒ†ãƒ¼ãƒ: ${firstPost.theme}\\næ•™è‚²: ${firstPost.education_type}`,\n  quickReply: {\n    items: [\n      {\n        type: 'action',\n        action: {\n          type: 'postback',\n          label: 'ğŸš€ XæŠ•ç¨¿',\n          data: `action=post&index=0`\n        }\n      },\n      {\n        type: 'action',\n        action: {\n          type: 'postback',\n          label: 'ğŸ’¾ ä¿å­˜',\n          data: `action=save&index=0`\n        }\n      },\n      {\n        type: 'action',\n        action: {\n          type: 'postback',\n          label: 'â¡ï¸ æ¬¡ã¸',\n          data: `action=next&index=1`\n        }\n      },\n      {\n        type: 'action',\n        action: {\n          type: 'message',\n          label: 'ğŸ—‘ï¸ ç ´æ£„',\n          text: 'ç ´æ£„'\n        }\n      }\n    ]\n  }\n};\n\nreturn { \n  json: {\n    replyToken: replyToken,\n    message: message,\n    userId: userId,\n    updateState: {\n      state: 'viewing_posts',\n      posts_data: JSON.stringify(posts),\n      current_index: 0\n    }\n  } \n};"
      },
      "id": "create-post-display",
      "name": "æŠ•ç¨¿è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1450, 400]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.nextAction }}",
              "value2": "show_help"
            }
          ]
        }
      },
      "id": "switch-action-help",
      "name": "ãƒ˜ãƒ«ãƒ—è¡¨ç¤º?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1050, 500]
    },
    {
      "parameters": {
        "functionCode": "const message = {\n  type: 'text',\n  text: `ğŸ¶ ãƒ›ã‚²ãƒ¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ä½¿ã„æ–¹\\n\\nã€ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€‘\\nğŸ“ æŠ•ç¨¿ç”Ÿæˆ: ãƒã‚ºæŠ•ç¨¿ã‚’ä½œæˆ\\nğŸ“– 3éƒ¨ä½œ: ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æŠ•ç¨¿ä½œæˆ\\nğŸ“š ä»Šæ—¥: ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒã§ç”Ÿæˆ\\nğŸ“ å­¦ç¿’: CSVå­¦ç¿’å®Ÿè¡Œ\\nğŸ“Š çŠ¶æ…‹: ç¾åœ¨ã®çŠ¶æ³ç¢ºèª\\nâ“ ãƒ˜ãƒ«ãƒ—: ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\\n\\nã€æŠ•ç¨¿è¡¨ç¤ºä¸­ã€‘\\nğŸš€ XæŠ•ç¨¿: Xã«å³æŠ•ç¨¿\\nğŸ’¾ ä¿å­˜: Sheetsã«ä¿å­˜\\nâ¡ï¸ æ¬¡ã¸: æ¬¡ã®æŠ•ç¨¿ã‚’è¡¨ç¤º\\nğŸ—‘ï¸ ç ´æ£„: ç ´æ£„ã—ã¦çµ‚äº†\\n\\nä½¿ã„æ–¹:\\n1. ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¿ãƒƒãƒ—\\n2. ä»¶æ•°/ãƒ†ãƒ¼ãƒã‚’é¸æŠ\\n3. ç”Ÿæˆã•ã‚ŒãŸæŠ•ç¨¿ã‚’ç¢ºèª\\n4. æŠ•ç¨¿ or ä¿å­˜ã‚’é¸æŠ`\n};\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: message,\n    userId: $input.item.json.userId\n  } \n};"
      },
      "id": "create-help-message",
      "name": "ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 500]
    },
    {
      "parameters": {
        "functionCode": "// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…ˆé€ã‚Š\nconst loadingMessage = {\n  type: 'text',\n  text: 'â³ ç”Ÿæˆä¸­ã§ã™...\\nã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„'\n};\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: loadingMessage,\n    userId: $input.item.json.userId,\n    generateParams: $input.item.json.generateParams,\n    updateState: $input.item.json.updateState\n  } \n};"
      },
      "id": "create-loading-message",
      "name": "ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 380]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.nextAction }}",
              "value2": "show_learn_confirm"
            }
          ]
        }
      },
      "id": "switch-action-learn-confirm",
      "name": "å­¦ç¿’ç¢ºèªè¡¨ç¤º?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1050, 600]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.nextAction }}",
              "value2": "execute_learn"
            }
          ]
        }
      },
      "id": "switch-action-learn-exec",
      "name": "å­¦ç¿’å®Ÿè¡Œ?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1050, 700]
    },
    {
      "parameters": {
        "functionCode": "const message = {\n  type: 'text',\n  text: 'ğŸ“ å­¦ç¿’ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\\n\\nå­¦ç¿’å†…å®¹:\\nãƒ»éå»ã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ\\nãƒ»ãƒã‚ºã‚Šã‚„ã™ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’\\nãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç²¾åº¦ã‚’å‘ä¸Š\\n\\næ‰€è¦æ™‚é–“: ç´„3ã€œ5åˆ†',\n  quickReply: {\n    items: [\n      {\n        type: 'action',\n        action: {\n          type: 'postback',\n          label: 'âœ… å®Ÿè¡Œã™ã‚‹',\n          data: 'action=learn_execute'\n        }\n      },\n      {\n        type: 'action',\n        action: {\n          type: 'message',\n          label: 'âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n          text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'\n        }\n      }\n    ]\n  }\n};\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: message,\n    userId: $input.item.json.userId\n  } \n};"
      },
      "id": "create-learn-confirm-message",
      "name": "å­¦ç¿’ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 600]
    },
    {
      "parameters": {
        "functionCode": "const loadingMessage = {\n  type: 'text',\n  text: 'ğŸ“ å­¦ç¿’ã‚’é–‹å§‹ã—ã¾ã™...\\nâ³ 3ã€œ5åˆ†ãŠå¾…ã¡ãã ã•ã„'\n};\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: loadingMessage,\n    userId: $input.item.json.userId\n  } \n};"
      },
      "id": "create-learn-loading",
      "name": "å­¦ç¿’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 700]
    },
    {
      "parameters": {
        "command": "cd c:\\Repos\\note-articles\\tools && python hogey_algorithm.py --learn --input my_posts_sample.csv"
      },
      "id": "execute-learn-script",
      "name": "å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1450, 720]
    },
    {
      "parameters": {
        "command": "cd c:\\Repos\\note-articles\\tools && set LINE_CHANNEL_ACCESS_TOKEN={{ $env.LINE_CHANNEL_ACCESS_TOKEN }} && set LINE_USER_ID={{ $env.ADMIN_LINE_USER_ID }} && python learn_with_progress_push.py --learn --input my_posts_sample.csv"
      },
      "id": "execute-learn-with-progress",
      "name": "å­¦ç¿’å®Ÿè¡Œï¼ˆé€²æ—é€šçŸ¥ä»˜ãï¼‰",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [450, 920],
      "notes": "å®šæœŸå®Ÿè¡Œç”¨ï¼šé€²æ—ã‚’LINE pushã§é€šçŸ¥"
    },
    {
      "parameters": {
        "functionCode": "const adminUserId = $env.ADMIN_LINE_USER_ID || 'U1234567890abcdef';\nconst message = {\n  type: 'text',\n  text: 'ğŸ“ å®šæœŸå­¦ç¿’ã‚’é–‹å§‹ã—ã¾ã—ãŸ\\nå®Œäº†ã¾ã§3ã€œ5åˆ†ãŠå¾…ã¡ãã ã•ã„'\n};\n\nreturn { \n  json: {\n    to: adminUserId,\n    message: message\n  } \n};"
      },
      "id": "create-scheduled-learn-start-push",
      "name": "å®šæœŸå­¦ç¿’é–‹å§‹é€šçŸ¥",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 900]
    },
    {
      "parameters": {
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "lineNotifyOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "messages",
              "value": "={{ JSON.stringify([$json.message]) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "line-push-scheduled",
      "name": "LINE Pushï¼ˆå®šæœŸï¼‰",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [850, 900]
    },
    {
      "parameters": {
        "functionCode": "const output = $node['å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ'].json;\nconst exitCode = output.exitCode || 0;\nconst stdout = output.stdout || '';\nconst stderr = output.stderr || '';\n\nlet message;\nif (exitCode === 0) {\n  // æˆåŠŸ\n  const lines = stdout.split('\\n').filter(l => l.trim());\n  const summary = lines.slice(-3).join('\\n');\n  message = {\n    type: 'text',\n    text: `âœ… å­¦ç¿’ãŒå®Œäº†ã—ã¾ã—ãŸï¼\\n\\n${summary}\\n\\næ¬¡å›ã®æŠ•ç¨¿ç”Ÿæˆã‹ã‚‰æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒåæ˜ ã•ã‚Œã¾ã™ã€‚`\n  };\n} else {\n  // å¤±æ•—\n  const errorSnippet = stderr.split('\\n').slice(0, 3).join('\\n');\n  message = {\n    type: 'text',\n    text: `âŒ å­¦ç¿’ã«å¤±æ•—ã—ã¾ã—ãŸ\\n\\nã‚¨ãƒ©ãƒ¼:\\n${errorSnippet}\\n\\nç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚`\n  };\n}\n\nreturn { \n  json: {\n    replyToken: $input.item.json.replyToken,\n    message: message,\n    userId: $input.item.json.userId\n  } \n};"
      },
      "id": "create-learn-result-message",
      "name": "å­¦ç¿’çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1650, 720]
    }
  ],
  "connections": {
    "å®šæœŸå­¦ç¿’ãƒˆãƒªã‚¬ãƒ¼": {
      "main": [[{ "node": "å®šæœŸå­¦ç¿’é–‹å§‹é€šçŸ¥", "type": "main", "index": 0 }]]
    },
    "å®šæœŸå­¦ç¿’é–‹å§‹é€šçŸ¥": {
      "main": [[
        { "node": "LINE Pushï¼ˆå®šæœŸï¼‰", "type": "main", "index": 0 },
        { "node": "å­¦ç¿’å®Ÿè¡Œï¼ˆé€²æ—é€šçŸ¥ä»˜ãï¼‰", "type": "main", "index": 0 }
      ]]
    },
    "LINE Webhook": {
      "main": [[{ "node": "ã‚³ãƒãƒ³ãƒ‰è§£æ", "type": "main", "index": 0 }]]
    },
    "ã‚³ãƒãƒ³ãƒ‰è§£æ": {
      "main": [[{ "node": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹å–å¾—", "type": "main", "index": 0 }]]
    },
    "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹å–å¾—": {
      "main": [[{ "node": "çŠ¶æ…‹åˆ¤å®š", "type": "main", "index": 0 }]]
    },
    "çŠ¶æ…‹åˆ¤å®š": {
      "main": [[
        { "node": "ä»¶æ•°é¸æŠè¡¨ç¤º?", "type": "main", "index": 0 },
        { "node": "ãƒ†ãƒ¼ãƒé¸æŠè¡¨ç¤º?", "type": "main", "index": 0 },
        { "node": "æŠ•ç¨¿ç”Ÿæˆå®Ÿè¡Œ?", "type": "main", "index": 0 },
        { "node": "ãƒ˜ãƒ«ãƒ—è¡¨ç¤º?", "type": "main", "index": 0 },
        { "node": "å­¦ç¿’ç¢ºèªè¡¨ç¤º?", "type": "main", "index": 0 },
        { "node": "å­¦ç¿’å®Ÿè¡Œ?", "type": "main", "index": 0 }
      ]]
    },
    "ä»¶æ•°é¸æŠè¡¨ç¤º?": {
      "main": [[{ "node": "ä»¶æ•°é¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", "type": "main", "index": 0 }]]
    },
    "ãƒ†ãƒ¼ãƒé¸æŠè¡¨ç¤º?": {
      "main": [[{ "node": "ãƒ†ãƒ¼ãƒé¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", "type": "main", "index": 0 }]]
    },
    "æŠ•ç¨¿ç”Ÿæˆå®Ÿè¡Œ?": {
      "main": [[
        { "node": "ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", "type": "main", "index": 0 }
      ]]
    },
    "ãƒ˜ãƒ«ãƒ—è¡¨ç¤º?": {
      "main": [[{ "node": "ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", "type": "main", "index": 0 }]]
    },
    "å­¦ç¿’ç¢ºèªè¡¨ç¤º?": {
      "main": [[{ "node": "å­¦ç¿’ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", "type": "main", "index": 0 }]]
    },
    "å­¦ç¿’å®Ÿè¡Œ?": {
      "main": [[{ "node": "å­¦ç¿’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°", "type": "main", "index": 0 }]]
    },
    "å­¦ç¿’ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [[{ "node": "LINEè¿”ä¿¡", "type": "main", "index": 0 }]]
    },
    "å­¦ç¿’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°": {
      "main": [[
        { "node": "LINEè¿”ä¿¡", "type": "main", "index": 0 },
        { "node": "å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ", "type": "main", "index": 0 }
      ]]
    },
    "å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ": {
      "main": [[{ "node": "å­¦ç¿’çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", "type": "main", "index": 0 }]]
    },
    "å­¦ç¿’çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [[{ "node": "LINEè¿”ä¿¡", "type": "main", "index": 0 }]]
    },
    "ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸": {
      "main": [[
        { "node": "LINEè¿”ä¿¡", "type": "main", "index": 0 },
        { "node": "Pythonå®Ÿè¡Œ", "type": "main", "index": 0 }
      ]]
    },
    "ä»¶æ•°é¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [[
        { "node": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹æ›´æ–°", "type": "main", "index": 0 }
      ]]
    },
    "ãƒ†ãƒ¼ãƒé¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [[
        { "node": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹æ›´æ–°", "type": "main", "index": 0 }
      ]]
    },
    "ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [[
        { "node": "LINEè¿”ä¿¡", "type": "main", "index": 0 }
      ]]
    },
    "Pythonå®Ÿè¡Œ": {
      "main": [[{ "node": "æŠ•ç¨¿è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ", "type": "main", "index": 0 }]]
    },
    "æŠ•ç¨¿è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ": {
      "main": [[
        { "node": "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹æ›´æ–°", "type": "main", "index": 0 }
      ]]
    },
    "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹æ›´æ–°": {
      "main": [[{ "node": "LINEè¿”ä¿¡", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-11-08T00:00:00.000Z",
  "versionId": "1"
}
