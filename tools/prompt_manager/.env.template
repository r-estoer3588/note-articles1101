# 環境変数設定テンプレート

n8n Cloud使用時は、環境変数として以下を設定します。

## n8n Cloud Environment Variables

### Settings → Environment Variables で設定

```bash
# Notion API
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# LINE Messaging API
LINE_CHANNEL_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LINE_CHANNEL_ACCESS_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# オプション: ログレベル
LOG_LEVEL=info
```

## ローカルn8n（Docker）使用時

### .env ファイル作成

`C:\n8n_data\.env` を作成:

```bash
# Notion API
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# LINE Messaging API
LINE_CHANNEL_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LINE_CHANNEL_ACCESS_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# n8n設定
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=your_password_here

# Webhook URL（ngrok使用時）
WEBHOOK_URL=https://xxxx-xxxx-xxxx.ngrok-free.app

# ログレベル
LOG_LEVEL=info
```

### Docker起動コマンド

```powershell
docker run -d `
  --name n8n `
  -p 5678:5678 `
  -v C:\n8n_data:/home/node/.n8n `
  --env-file C:\n8n_data\.env `
  n8nio/n8n
```

## ngrok設定（ローカルn8n使用時）

### ngrok.yml

`%USERPROFILE%\.ngrok2\ngrok.yml`:

```yaml
authtoken: your_ngrok_auth_token
tunnels:
  n8n:
    proto: http
    addr: 5678
    bind_tls: true
```

### ngrok起動

```powershell
ngrok start n8n
```

## 認証情報の取得方法

### Notion Integration Token

1. https://www.notion.so/my-integrations
2. 「+ New integration」
3. 「Submit」後に表示される**Internal Integration Token**

### Notion Database ID

1. データベースページのURLをコピー
   ```
   https://www.notion.so/workspace-name/DATABASE_ID?v=view_id
   ```
2. `DATABASE_ID`部分（32文字の英数字）

### LINE Channel Secret

1. https://developers.line.biz/console/
2. チャネル → 「Basic settings」タブ
3. **Channel secret**

### LINE Channel Access Token

1. チャネル → 「Messaging API」タブ
2. **Channel access token** → 「Issue」ボタン
3. 発行されたトークン

## セキュリティ注意事項

⚠️ **絶対に公開しないこと**:
- `.env`ファイルをGitにコミットしない
- 認証情報をSlack/Discord等で共有しない
- スクリーンショットに認証情報を含めない

### .gitignore設定

```gitignore
# 環境変数
.env
.env.local
.env.*.local

# n8nデータ
n8n_data/

# ngrok設定
.ngrok2/ngrok.yml
```

## 認証情報のローテーション

### 定期的な更新推奨（3ヶ月ごと）

1. **Notion Integration Token**:
   - My integrations → Integration → 「Regenerate token」
   - 新トークンをn8nに再設定

2. **LINE Channel Access Token**:
   - Messaging API → Channel access token → 「Reissue」
   - 新トークンをn8nに再設定

3. **ngrok Auth Token**（ローカル使用時）:
   - ngrokダッシュボード → Your Authtoken → 「Regenerate」

---

**最終更新**: 2025-11-16
