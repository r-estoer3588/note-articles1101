# 📱 LINE Bot メニュー版 セットアップチェックリスト

**所要時間: 30-40分**

完全ボタン操作のLINE Botをセットアップするためのチェックリスト。

---

## ✅ 事前準備（5分）

- [ ] LINE Developersアカウント
- [ ] Messaging APIチャネル作成済み
- [ ] チャネルアクセストークン取得済み
- [ ] n8nインストール済み（v1.0以降）
- [ ] Google アカウント（Sheets用）
- [ ] Python 3.8以上 + pandas

---

## 🎨 STEP 1: リッチメニュー作成（10分）

### 1-1. 画像準備

```
サイズ: 2500 x 1686 px
形式: PNG または JPEG
```

**簡単な方法**: Canvaで作成
1. Canvaにログイン
2. カスタムサイズ: 2500 x 1686
3. 6分割レイアウト（2列×3行）
4. 各エリアに絵文字+テキスト配置

```
┌──────────┬──────────┐
│ 📝       │ 📖       │
│ 投稿生成 │ 3部作    │
├──────────┼──────────┤
│ 📚       │ 🎓       │
│ 今日     │ 学習     │
├──────────┼──────────┤
│ 📊       │ ❓       │
│ 状態     │ ヘルプ   │
└──────────┴──────────┘
```

- [ ] 画像ファイル作成完了（rich_menu.png）

### 1-2. LINE Developersでリッチメニュー作成

1. **LINE Developers Console** にアクセス
   ```
   https://developers.line.biz/console/
   ```

2. チャネル選択 → **Messaging API設定**

3. **リッチメニュー** タブ → **作成**

4. **基本設定**
   ```
   タイトル: ホゲーメニュー
   表示期間: 常に表示
   メニューバーのテキスト: メニュー
   ```

5. **テンプレート選択**
   ```
   大テンプレート
   6分割（2列×3行）
   ```

6. **画像アップロード**
   - [ ] rich_menu.png をアップロード

7. **アクション設定**

   | エリア | アクションタイプ | テキスト |
   |--------|------------------|----------|
   | A（左上） | テキスト | `menu:generate` |
   | B（右上） | テキスト | `menu:trilogy` |
   | C（左中） | テキスト | `menu:today` |
   | D（右中） | テキスト | `menu:learn` |
   | E（左下） | テキスト | `menu:status` |
   | F（右下） | テキスト | `menu:help` |

8. **保存**して**公開**

- [ ] リッチメニュー作成完了
- [ ] リッチメニューIDをコピー（後で使用）

---

## 📊 STEP 2: Google Sheets準備（5分）

### 2-1. スプレッドシート作成

1. Google Sheetsで新規作成
2. 名前: `ホゲーアルゴリズム管理`

### 2-2. シート1: ユーザー状態管理

| user_id | state | count | theme | posts_data | current_index | updated_at | type |
|---------|-------|-------|-------|------------|---------------|------------|------|
| U123... | idle  |       |       |            | 0             | 2025-11-08 |      |

**列の説明**:
- A: user_id（LINEユーザーID）
- B: state（状態: idle/selecting_count/selecting_theme/viewing_posts）
- C: count（選択した件数）
- D: theme（選択したテーマ）
- E: posts_data（生成した投稿のJSON）
- F: current_index（現在の投稿番号）
- G: updated_at（更新日時）
- H: type（生成タイプ: buzz/trilogy/today）

- [ ] ヘッダー行作成完了

### 2-3. シート2: 投稿データ（オプション）

保存用のシートを作成（後で使用）:

| post_id | text | theme | education_type | created_at | posted | posted_at |
|---------|------|-------|----------------|------------|--------|-----------|

- [ ] 保存用シート作成完了

### 2-4. シートID取得

URLから取得:
```
https://docs.google.com/spreadsheets/d/【ここがシートID】/edit
```

- [ ] シートIDをコピー: `_____________________`

### 2-5. サービスアカウント連携

1. Google Cloud Console
2. APIとサービス → 認証情報
3. サービスアカウント作成
4. JSONキーをダウンロード
5. Sheetsに共有（編集権限）

- [ ] サービスアカウント設定完了

---

## 🔧 STEP 3: n8nワークフロー設定（10分）

### 3-1. n8nワークフローインポート

1. n8nを起動
   ```powershell
   npx n8n
   ```

2. ブラウザで開く: http://localhost:5678

3. **ワークフロー** → **インポート**

4. `n8n_workflow_menu_complete.json` を選択

- [ ] ワークフローインポート完了

### 3-2. 認証情報設定

#### Google Sheets認証

1. **ユーザー状態取得** ノードを開く
2. **認証情報** → **新規作成**
3. サービスアカウントJSONをペースト
4. 保存

- [ ] Google Sheets認証完了

#### LINE Webhook設定

1. **LINE Webhook** ノードを開く
2. Webhook URLをコピー
   ```
   https://YOUR_N8N_URL/webhook/hogey-bot
   ```
3. LINE Developers → Webhook URL に設定
4. Webhook送信: **利用する**

- [ ] Webhook設定完了

### 3-3. 設定値の更新

以下のノードで値を更新:

#### ユーザー状態取得
```javascript
sheetId: "YOUR_SHEET_ID" // 実際のシートIDに変更
```

#### LINE返信
```javascript
headerParameters: [
  {
    name: "Authorization",
    value: "Bearer YOUR_CHANNEL_ACCESS_TOKEN" // 実際のトークンに変更
  }
]
```

#### Python実行
```javascript
command: "cd c:\\Repos\\note-articles\\tools && python hogey_algorithm.py ..."
// 実際のパスに変更
```

- [ ] 全設定値更新完了

### 3-4. ワークフロー有効化

右上の **非アクティブ** → **アクティブ** に切り替え

- [ ] ワークフロー有効化完了

---

## 🐍 STEP 4: Python環境確認（3分）

### 4-1. スクリプト配置確認

```powershell
cd c:\Repos\note-articles\tools
ls hogey_algorithm.py
```

- [ ] スクリプト存在確認

### 4-2. 依存関係インストール

```powershell
pip install pandas
```

- [ ] pandas インストール完了

### 4-3. 動作テスト

```powershell
python hogey_algorithm.py --count 1 --theme "テスト" --output test.csv
```

- [ ] テスト実行成功
- [ ] test.csv 生成確認

---

## 🧪 STEP 5: 動作確認（5分）

### 5-1. LINE Botを友だち追加

1. LINE Developers → Messaging API設定
2. QRコードをスキャン
3. 友だち追加

- [ ] Bot友だち追加完了

### 5-2. リッチメニュー表示確認

LINEアプリを開いて:
- [ ] 画面下部にメニューが表示される
- [ ] 6つのボタンが正しく配置されている

### 5-3. 基本フロー確認

#### テストA: 投稿生成

1. **📝 投稿生成** をタップ
2. 「何件生成しますか?」表示 → **3件** タップ
3. 「テーマを選んでください」表示 → **💼 副業** タップ
4. ⏳ 生成中メッセージ表示
5. 投稿1/3 が表示される
6. **➡️ 次へ** で次の投稿表示

- [ ] 投稿生成フロー成功

#### テストB: 今日のテーマ

1. **📚 今日** をタップ
2. 「今日は〇〇のテーマです」表示
3. **5件** タップ
4. 投稿が生成される

- [ ] 今日のテーマフロー成功

#### テストC: ヘルプ

1. **❓ ヘルプ** をタップ
2. 使い方が表示される

- [ ] ヘルプ表示成功

### 5-4. エラーハンドリング確認

意図的に変なテキストを送信:
- [ ] エラーメッセージ表示
- [ ] 「メニューから操作してください」的な案内

---

## 🚀 STEP 6: 本番運用準備（オプション）

### 6-1. X API連携（投稿機能）

未実装の場合:

1. X Developer Portal
2. API キー取得
3. n8nに「X投稿」ノード追加
4. `action=post` 時に実行

- [ ] X API連携完了（オプション）

### 6-2. 自動学習設定

定期的にCSV学習を実行:

1. n8nで「Cron」ノード追加
2. 毎日 2:00 AM に実行
3. `python hogey_algorithm.py learn` を実行

- [ ] 自動学習設定完了（オプション）

### 6-3. 監視設定

エラー通知:

1. n8nの「Error Trigger」ノード追加
2. エラー時にLINE通知
3. ログをGoogle Sheetsに記録

- [ ] 監視設定完了（オプション）

---

## 📱 使用方法（完成後）

### 基本操作

1. LINEを開く
2. Botのトーク画面を開く
3. 画面下部のメニューをタップ
4. ボタンに従って操作

### フロー例

```
[リッチメニュー] 投稿生成タップ
  ↓
[クイックリプライ] 5件タップ
  ↓
[クイックリプライ] 💼副業タップ
  ↓
⏳ 生成中...
  ↓
🐶 投稿1/5表示
[🚀 X投稿] [💾 保存] [➡️ 次へ] [🗑️ 破棄]
  ↓
[🚀 X投稿]タップ → Xに投稿完了！
```

**コマンド不要。全てボタン操作。**

---

## 🆘 トラブルシューティング

### ボタンが表示されない

- [ ] リッチメニューが公開済みか確認
- [ ] Botを一度ブロック→ブロック解除

### 生成されない

- [ ] n8nワークフローが有効か
- [ ] Pythonパスが正しいか
- [ ] Google Sheets権限が正しいか

### タイムアウトする

- [ ] n8nのタイムアウト設定を延長（60秒→300秒）
- [ ] ローディングメッセージを先送り

### 状態がリセットされる

- [ ] Google Sheetsの書き込み権限確認
- [ ] ユーザーIDが正しく保存されているか

---

## 📋 完了チェック

最終確認:

- [ ] リッチメニュー表示
- [ ] 投稿生成成功（3件テスト）
- [ ] 次へボタンで遷移
- [ ] ヘルプ表示
- [ ] エラー時の案内表示
- [ ] Google Sheetsに状態保存

**全て完了 → 🎉 運用開始！**

---

## 📚 参考ドキュメント

- `LINE_MENU_IMPLEMENTATION.md` - 実装詳細
- `LINE_MENU_GUIDE.md` - コンセプト説明
- `HOGEY_ALGORITHM_README.md` - アルゴリズム仕様
- `n8n_workflow_menu_complete.json` - ワークフロー定義

---

**所要時間: 30-40分**
**難易度: ★★☆☆☆（中級）**
**コマンド暗記: 不要**

平日でもスマホでホゲホゲ生成！
