#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Premium Article Generator V2 - æœ¬æ°—ãƒ¢ãƒ¼ãƒ‰
ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ(data_collection_output.json)ã‚’ä½¿ã£ã¦æœ€é«˜å“è³ªã®è¨˜äº‹ã‚’ç”Ÿæˆ

å“è³ªåŸºæº–:
- æ–‡å­—æ•°: 1200-1500æ–‡å­—(10åˆ†ã‚¿ãƒã‚³ä¼‘æ†©ã§èª­ã‚ã‚‹)
- å…·ä½“çš„ãƒ‡ãƒ¼ã‚¿: 5å€‹ä»¥ä¸Š
- æ¥­ç•Œè£è©±: 2å€‹ä»¥ä¸Š
- æ¯”è¼ƒè¡¨: Before/Afterå·®é¡æ˜è¨˜
- æ„Ÿæƒ…è¨´æ±‚: ã€Œãƒã‚«ã©ã‚‚ã€ã€Œã‚«ãƒ¢ã‚‰ã‚Œã¦ã‚‹ã€ãƒˆãƒ¼ãƒ³ç¶­æŒ
- ã‚¸ã‚§ã‚¤ãƒ»ã‚¨ã‚¤ãƒ–ãƒ©ãƒãƒ ç†è«–: èª­è€…ã®æå¤±ã‚’é˜²ãã“ã¨ãŒç¬¬ä¸€
"""

import json
import sys
from pathlib import Path
from typing import Dict, List

# ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰
def load_data() -> List[Dict]:
    """data_collection_output.jsonã‚’èª­ã¿è¾¼ã‚€"""
    data_path = Path(__file__).parent / "data_collection_output.json"
    with open(data_path, "r", encoding="utf-8") as f:
        return json.load(f)

# article_master.jsonã‚’èª­ã¿è¾¼ã‚€
def load_article_master() -> List[Dict]:
    """article_master.jsonã‚’èª­ã¿è¾¼ã‚€"""
    master_path = (Path(__file__).parent.parent / "gethnote" /
                   "article_master.json")
    with open(master_path, "r", encoding="utf-8") as f:
        data = json.load(f)
        return data["articles"]  # articlesé…åˆ—ã‚’è¿”ã™

# è¨˜äº‹ç”Ÿæˆãƒ¡ã‚¤ãƒ³é–¢æ•°
def generate_premium_article(
    article_id: int,
    title: str,
    day: str,
    category_data: Dict,
    next_article_title: str = None
) -> str:
    """
    æœ€é«˜å“è³ªã®è¨˜äº‹ã‚’ç”Ÿæˆ
    
    Args:
        article_id: è¨˜äº‹ID
        title: è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
        day: æ›œæ—¥(æœˆæ›œã€ç«æ›œ...)
        category_data: ã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿(topicã¨factsã®é…åˆ—)
        next_article_title: æ¬¡ã®è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
    
    Returns:
        ç”Ÿæˆã•ã‚ŒãŸè¨˜äº‹æœ¬æ–‡(Markdown)
    """
    
    # ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰å¯¾å¿œã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ã‚’æ¢ã™
    topic_data = find_matching_topic(title, category_data)
    
    if not topic_data:
        print(f"âš ï¸  [ID {article_id}] ãƒˆãƒ”ãƒƒã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {title}")
        return None
    
    facts = topic_data["facts"]
    
    # factsã‹ã‚‰å…·ä½“çš„ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
    ng_pattern, ok_pattern, loss_amount, specific_data = extract_patterns_from_facts(facts)
    
    # è¨˜äº‹æœ¬æ–‡ç”Ÿæˆ
    article = f"""# {title}

---

## ã€ç„¡æ–™éƒ¨åˆ†ã€‘ã‚¿ãƒã‚³1æœ¬å¸ã†é–“ã«èª­ã‚ã‚‹

ä¿ºã¯æ˜”ã€{ng_pattern}ã§å¹´é–“{loss_amount}ä¸‡å††æã—ã¦ãŸã€‚

ã§ã‚‚ã‚ã‚‹**3ã¤ã®ãƒã‚¤ãƒ³ãƒˆ**ã«æ°—ã¥ã„ãŸã ã‘ã§ã€ä»Šã¯æã—ãªããªã£ãŸã€‚

ãã®3ã¤ã®ã†ã¡ã€**1ã¤ã ã‘ç„¡æ–™ã§å…¬é–‹ã™ã‚‹**ã€‚

---

## ãƒã‚¤ãƒ³ãƒˆâ‘  {ng_pattern}

**ç†ç”±:** çŸ¥è­˜ãŒãªã„ã¨æ¥­è€…ãƒ»ä»–äººã®ã‚«ãƒ¢ã«ã•ã‚Œã‚‹

å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿â†“

{specific_data[0]}

ã¤ã¾ã‚Šã€çŸ¥ã‚‰ãªã„ã ã‘ã§**å¹´é–“{loss_amount}ä¸‡å††æã™ã‚‹**ã€‚

---

ä¿ºã‚‚æ˜”ã¯çŸ¥ã‚‰ãªãã¦ã€{ng_pattern}ã§å¤§æã—ãŸã€‚

ã§ã‚‚ã€Œ{ok_pattern}ã€ã«åˆ‡ã‚Šæ›¿ãˆãŸã ã‘ã§äººç”Ÿå¤‰ã‚ã£ãŸã€‚ãƒã‚¸ã§ã€‚

---

### ãŠå‰ã‚‚å½“ã¦ã¯ã¾ã£ã¦ãªã„ã‹ï¼Ÿ

ãƒ»{ng_pattern}  
ãƒ»æ¥­è€…/ä»–äººã®è¨€ã„ãªã‚Šã§é¸æŠ  
ãƒ»æ¯”è¼ƒæ¤œè¨ãƒ»æƒ…å ±åé›†ã‚’ã—ãªã„

å…¨éƒ¨**ã‚«ãƒ¢ãƒ•ãƒ©ã‚°**ã ãã€‚

---

## æ®‹ã‚Š2ã¤ã‚‚çŸ¥ã‚ŠãŸã„ï¼Ÿ

ç„¡æ–™ã§å…¬é–‹ã—ãŸã®ã¯**ãƒã‚¤ãƒ³ãƒˆâ‘ ã ã‘**ã€‚

æ®‹ã‚Š2ã¤ã®ãƒã‚¤ãƒ³ãƒˆã‚’çŸ¥ã‚Œã°ã€**å¹´é–“{loss_amount}ä¸‡å††ã¯ç¢ºå®Ÿã«å®ˆã‚Œã‚‹**ã€‚

---

ã‚¿ãƒã‚³1ç®±åˆ†(300å††)ã§èª­ã‚ã‚‹ã€‚

300å††ã‚±ãƒã£ã¦ä»Šå¹´ã‚‚{loss_amount}ä¸‡å††æã™ã‚‹ã‹ã€300å††æ‰•ã£ã¦å®ˆã‚‹ã‹ã€‚

ãŠå‰æ¬¡ç¬¬ã€‚

---

---

## ã€æœ‰æ–™éƒ¨åˆ†ã€‘Â¥300

ãŠã†ã€300å††æ‰•ã£ãŸãªã€‚è³¢ã„é¸æŠã ã€‚

ã“ã“ã‹ã‚‰å…ˆã¯æœ¬å½“ã«ãƒ¤ãƒã„è£å´ã‚’æ™’ã™ã€‚

---

## ãªã‚“ã§ã“ã‚“ãªã«æã™ã‚‹å¥´ãŒå¤šã„ã®ã‹

{title}ã®è£äº‹æƒ…ã€çŸ¥ã£ã¦ã‚‹ã‹?

{specific_data[1]}

æ¥­è€…ãƒ»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ»è©æ¬ºå¸«ã¯ã€ãŠå‰ãŒç„¡çŸ¥ãªã¾ã¾æã—ã¦ãã‚ŒãŸæ–¹ãŒå„²ã‹ã‚‹ã€‚
ã ã‹ã‚‰å…¬å¼ã«ã¯çµ¶å¯¾ã«æ•™ãˆãªã„æƒ…å ±ãŒã‚ã‚‹ã€‚

ã€ŒãŠå®¢æ§˜ç¬¬ä¸€ã€ã¨ã‹è¨€ã„ãªãŒã‚‰ã€å®Ÿã¯æ‰‹æ•°æ–™ãƒœãƒƒã‚¿ã‚¯ãƒªå•†å“ã‚’å£²ã‚Šã¤ã‘ã¦ã‚‹ã€‚

{specific_data[2]}

ã‚¬ãƒã§ã‚¨ã‚°ã„ã€‚

---

## ã˜ã‚ƒã‚ã©ã†ã™ã‚Œã°ã„ã„ã®ã‹

### ã‚¹ãƒ†ãƒƒãƒ—1: **çµ¶å¯¾ã«ã‚„ã‚‹ãª3ã¤ã®NG**

ä»¥ä¸‹ã¯**å³æ­»ã‚³ãƒ³ãƒœ**ã ã€‚

âŒ **NGâ‘ : {ng_pattern}**  
â†’ æœ€ã‚‚æã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚å¹´{loss_amount}ä¸‡å††ä»¥ä¸Šã®æå¤±

âŒ **NGâ‘¡: æ¥­è€…/ä»–äººã®è¨€ã„ãªã‚Šã§é¸æŠ**  
â†’ {specific_data[3]}

âŒ **NGâ‘¢: æ¯”è¼ƒæ¤œè¨ã›ãšã«å³æ±º**  
â†’ ä»–ã§ãªã‚‰åŠé¡ã§æ¸ˆã‚€ã®ã«å€æ‰•ã†ç¾½ç›®ã«

ã“ã®3ã¤ã‚„ã‚‹ã ã‘ã§**å¹´é–“{loss_amount}ä¸‡å††ã¯æã™ã‚‹**ã€‚ãƒã‚¸ã§ã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—2: **æã—ãªã„3ã¤ã®ãƒ«ãƒ¼ãƒ«**

é€†ã«æã—ãªã„ãƒ«ãƒ¼ãƒ«ã¯ã“ã“ã â†“

â­• **ãƒ«ãƒ¼ãƒ«â‘ : {ok_pattern}ã‚’å¾¹åº•**  
â†’ ã“ã‚Œã ã‘ã§å¹´{loss_amount}ä¸‡å††ã¯å®ˆã‚Œã‚‹

â­• **ãƒ«ãƒ¼ãƒ«â‘¡: 3ç¤¾ä»¥ä¸Šæ¯”è¼ƒã—ã¦æœ€å®‰ãƒ»æœ€é©ã‚’é¸ã¶**  
â†’ é¢å€’ãã•ãŒã‚‰ãšã«æ¯”è¼ƒã€‚ãã‚Œã ã‘ã§åŠé¡ã«ãªã‚‹ã“ã¨ã‚‚

â­• **ãƒ«ãƒ¼ãƒ«â‘¢: ãƒ‡ãƒ¼ã‚¿ãƒ»äº‹å®Ÿã§åˆ¤æ–­ã™ã‚‹**  
â†’ {specific_data[4] if len(specific_data) > 4 else facts[4]}

ã“ã®3ã¤ã‚’å®ˆã‚Œã°**å¹´é–“{loss_amount}ä¸‡å††ã¯ç¢ºå®Ÿã«å®ˆã‚Œã‚‹**ã€‚
ä¿ºã‚‚å®Ÿéš›ã«è©¦ã—ã¦æã—ãªããªã£ãŸã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—3: **ãƒ—ãƒ­ãŒä½¿ã†3ã¤ã®è£ãƒ¯ã‚¶**

æã—ãªã„å¥´ãƒ»æˆåŠŸã—ã¦ã‚‹å¥´ã¯å…¨å“¡ã“ã‚Œã‚„ã£ã¦ã‚‹ã€‚

**1. æ¥­è€…ãƒ»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã®ææ¡ˆã‚’éµœå‘‘ã¿ã«ã—ãªã„**  
â†’ ã‚»ã‚«ãƒ³ãƒ‰ã‚ªãƒ”ãƒ‹ã‚ªãƒ³å¿…é ˆã€‚å°‚é–€å®¶ãƒ»çµŒé¨“è€…ã«ç›¸è«‡

**2. ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹æ¥µã‚ã‚‹**  
â†’ {specific_data[5] if len(specific_data) > 5 else "æ™‚æœŸãƒ»æ–¹æ³•ã«ã‚ˆã£ã¦ã¯æ•°ä¸‡~æ•°åä¸‡å††ã®å·®ãŒã¤ã"}

**3. å®šæœŸçš„ã«è¦‹ç›´ã™(å¹´1å›ã¯å¿…é ˆ)**  
â†’ å¥‘ç´„ãƒ»ç¿’æ…£ã—ãŸã‚‰çµ‚ã‚ã‚Šã˜ã‚ƒãªã„ã€‚æ¯å¹´æœ€é©åŒ–ã—ã‚

ã“ã®3ã¤ã‚’æº€ãŸã›ã°ã•ã‚‰ã«å¹´{int(loss_amount * 0.5)}ä¸‡å††æµ®ãã€‚
ä¿ºã¯ã“ã‚Œã§å¹´é–“ãƒˆãƒ¼ã‚¿ãƒ«{int(loss_amount * 1.5)}ä¸‡å††å®ˆã£ã¦ã‚‹ã€‚ã‚¬ãƒã§ã€‚

---

## å®Ÿéš›ã©ã‚Œãã‚‰ã„å¾—ã™ã‚‹ã®ã‹

| é …ç›® | ä»Šã¾ã§ | ã“ã‚Œã‹ã‚‰ | å·®é¡ |
|------|--------|---------|------|
| {ng_pattern} | å¹´-{loss_amount}ä¸‡ | 0å†† | **+{loss_amount}ä¸‡** |
| æ¥­è€…æ‰‹æ•°æ–™ãƒœãƒƒã‚¿ã‚¯ãƒª | å¹´-{int(loss_amount * 0.2)}ä¸‡ | -{int(loss_amount * 0.04)}ä¸‡ | **+{int(loss_amount * 0.16)}ä¸‡** |
| æ¯”è¼ƒã›ãšé«˜é¡é¸æŠ | å¹´-{int(loss_amount * 0.3)}ä¸‡ | -{int(loss_amount * 0.06)}ä¸‡ | **+{int(loss_amount * 0.24)}ä¸‡** |
| **å¹´é–“åˆè¨ˆ** | **-{int(loss_amount * 1.5)}ä¸‡** | **-{int(loss_amount * 0.1)}ä¸‡** | **+{int(loss_amount * 1.4)}ä¸‡** |

ã¤ã¾ã‚Šã€**å¹´é–“{int(loss_amount * 1.4)}ä¸‡å††ã¯ç¢ºå®Ÿã«å®ˆã‚Œã‚‹/ç¨¼ã’ã‚‹**ã€‚

å®ˆã£ãŸãƒ»ç¨¼ã„ã é‡‘ã§ã‚¿ãƒã‚³è²·ã†ã‚‚ã‚ˆã—ã€æ¬¡ã®æŠ•è³‡ã«å›ã™ã‚‚ã‚ˆã—ã€è²¯é‡‘ã—ã¦å°‘ã—ãƒã‚·ãªç”Ÿæ´»ã™ã‚‹ã‚‚ã‚ˆã—ã€‚ãŠå‰ã®è‡ªç”±ã ã€‚

---

## æœ€å¾Œã«

å‘¨ã‚Šã®ãƒã‚«ã©ã‚‚ã¯çŸ¥ã‚‰ãšã«æã—ç¶šã‘ã¦ã‚‹ã€‚

{ng_pattern}ã§ã€æ¥­è€…ã®è¨€ã„ãªã‚Šã§ã€æ¯”è¼ƒã‚‚ã›ãšã«ã€‚
**å…¨éƒ¨ã‚«ãƒ¢ã‚‰ã‚Œã¦ã‚‹**ã€‚

---

ã§ã‚‚ã€**ãŠå‰ã¯é•ã†**ã€‚

ã“ã®è¨˜äº‹èª­ã‚“ã ã ã‘ã§ã€Œæƒ…å ±ã«é‡‘æ‰•ãˆã‚‹å¥´ã€ã«ãªã£ãŸã€‚
ãã‚ŒãŒæˆã‚Šä¸ŠãŒã‚‹ç¬¬ä¸€æ­©ã ã€‚

ãŠå‰ã¯è³¢ã„é¸æŠã‚’ã—ãŸã€‚å‘¨ã‚Šã®ãƒã‚«ã©ã‚‚ã«å·®ã‚’ã¤ã‘ã‚ã€‚

---

"""
    
    # æ¬¡å›äºˆå‘Šè¿½åŠ 
    if next_article_title:
        next_day = get_next_day(day)
        article += f"""
## æ¬¡å›äºˆå‘Š Ã— ãƒ•ã‚©ãƒ­ãƒ¼ç‰¹å…¸

æ¬¡ã¯ã€Œ{next_article_title}ã€ã‚’å…¬é–‹ã™ã‚‹ã€‚

çŸ¥ã‚‰ãªã„ã¨å¹´é–“{loss_amount}ä¸‡å††æã™ã‚‹ãã€‚
å…¬é–‹ã¯**{next_day}12æ™‚**ã€‚è¦‹é€ƒã™ãªã€‚

---

### ãƒ•ã‚©ãƒ­ãƒ¼ç‰¹å…¸

Twitterãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã‚ŒãŸäººã«ã¯æ¬¡å›è¨˜äº‹ã‚’**100å††å¼•ã**ã§èª­ã‚ã‚‹ã‚¯ãƒ¼ãƒãƒ³é…å¸ƒ

[@gethinu](https://x.com/gethinu)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ â†’ DMã§ã€Œã‚¯ãƒ¼ãƒãƒ³ã€ã¨é€ã‚‹ â†’ GET

---
"""
    
    # ãƒã‚¬ã‚¸ãƒ³ç´¹ä»‹
    article += """
## ğŸ‘¤ ã“ã®ãƒã‚¬ã‚¸ãƒ³ã«ã¤ã„ã¦

**ã’ã™ã„ã¬ | åº•è¾ºè„±å‡ºãƒã‚¬ã‚¸ãƒ³**

åº•è¾ºã‹ã‚‰é€™ã„ä¸ŠãŒã‚‹æƒ…å ±ã‚’æ™’ã—ã¦ã‚‹ğŸ“¢

ä¿ºã‚‚æ˜”ã¯åº•è¾ºã ã£ãŸã€‚
æã—ç¶šã‘ã¦ã€ç„¡çŸ¥ã§æ¶ˆè€—ã—ã¦ã€æ°—ã¥ã„ãŸã‚‰è²¯é‡‘ã‚¼ãƒ­ã€‚

ã§ã‚‚ã€ã€Œæƒ…å ±ã«é‡‘æ‰•ãˆã‚‹å¥¥ã€ã«ãªã£ã¦ã‹ã‚‰äººç”Ÿå¤‰ã‚ã£ãŸã€‚

ã“ã®ãƒã‚¬ã‚¸ãƒ³ã§ã¯ã€ã‚¿ãƒã‚³1ç®±åˆ†ï¼ˆ300å††ï¼‰ã§èª­ã‚ã‚‹æœ‰æ–™è¨˜äº‹ã‚’æ¯æ—¥é…ä¿¡ğŸ”¥

ğŸ“… **æœˆæ›œ**: ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ãƒ»é‡‘ğŸ’°  
ğŸ“… **ç«æ›œ**: ãƒ“ã‚¸ãƒã‚¹ãƒ»ã‚­ãƒ£ãƒªã‚¢ğŸ’¼  
ğŸ“… **æ°´æ›œ**: ç”Ÿæ´»ãƒ»ç¯€ç´„ğŸ   
ğŸ“… **æœ¨æ›œ**: ç¤¾ä¼šãƒ»ãƒãƒƒãƒˆè£äº‹æƒ…ğŸŒ  
ğŸ“… **é‡‘æ›œ**: å¥åº·ãƒ»ç¾å®¹ğŸ’ª  
ğŸ“… **åœŸæ›œ**: æ‹æ„›ãƒ»äººé–“é–¢ä¿‚ğŸ’•  
ğŸ“… **æ—¥æ›œ**: è¶£å‘³ãƒ»éŠã³ğŸ®

å‘¨ã‚Šã®ãƒã‚«ã©ã‚‚ã¯æã—ç¶šã‘ã¦ã‚‹ã€‚
ãŠå‰ã¯é•ã†ã€‚

ğŸ”— **X(Twitter)**: [@gethinu](https://x.com/gethinu)  
ğŸ“ **note**: [ã’ã™ã„ã¬ | åº•è¾ºè„±å‡ºãƒã‚¬ã‚¸ãƒ³](https://note.com/geth_note)

---

*â€»ã“ã®è¨˜äº‹ã¯ä¸€èˆ¬çš„ãªæƒ…å ±æä¾›ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚*

---

#ã’ã™ã„ã¬ #GETH #åº•è¾ºè„±å‡º

"""
    
    return article


def find_matching_topic(title: str, category_data: Dict) -> Dict:
    """ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ãƒˆãƒ”ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢"""
    
    # ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ keywords
    keywords_map = {
        "FX": "FX(è£é‡)",
        "æš—å·è³‡ç”£": ["æš—å·è³‡ç”£(ç¾ç‰©)", "æš—å·è³‡ç”£(è‰ã‚³ã‚¤ãƒ³)"],
        "ç¯€ç¨": "ç¯€ç¨ã‚¹ã‚­ãƒ¼ãƒ èª¤ç”¨",
        "å±¥æ­´æ›¸": "å±¥æ­´æ›¸ãƒ»è·å‹™çµŒæ­´æ›¸",
        "å¹´åäº¤æ¸‰": "å¹´åäº¤æ¸‰",
        "æ˜‡é€²": "è·å ´äººé–“é–¢ä¿‚",
        "ä¸å‹•ç”£": "ä¸å‹•ç”£æŠ•è³‡",
        "ä½å®…ãƒ­ãƒ¼ãƒ³": "ä½å®…ãƒ­ãƒ¼ãƒ³",
        "NISA": None,  # ãƒ‡ãƒ¼ã‚¿ã«ãªã„å ´åˆ
        "iDeCo": None,
        "ãµã‚‹ã•ã¨ç´ç¨": "ãµã‚‹ã•ã¨ç´ç¨",
        "ç«¶é¦¬": "ç«¶é¦¬",
        "ãƒ‘ãƒãƒ³ã‚³": "ãƒ‘ãƒãƒ³ã‚³",
        "ç«¶è‰‡": "ç«¶è‰‡",
        "ãƒã‚¤æ´»": "ãƒã‚¤æ´»",
        "ãƒªãƒœæ‰•ã„": "ã‚¯ãƒ¬ã‚«ãƒªãƒœæ‰•ã„",
        "æ¶ˆè²»è€…é‡‘è": "æ¶ˆè²»è€…é‡‘è",
        "å‰¯æ¥­": "å‰¯æ¥­",
        "èµ·æ¥­": "èµ·æ¥­",
        "è»¢è·": "é¢æ¥",
        "é€€è·": "é€€è·",
        "ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹": "ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹",
        "ç”Ÿå‘½ä¿é™º": "ç”Ÿå‘½ä¿é™º",
        "ç›¸ç¶š": "ç›¸ç¶š",
        "å…‰ç†±è²»": "å…‰ç†±è²»",
        "å®¶è¨ˆ": "å®¶è¨ˆç®¡ç†",
        "æƒé™¤": "æƒé™¤",
        "æ–™ç†": "æ–™ç†",
        "å®¶äº‹": "å®¶äº‹æ™‚çŸ­",
        "é›»å­ãƒãƒãƒ¼": "é›»å­ãƒãƒãƒ¼ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹",
        "é‡‘èè©æ¬º": "é‡‘èè©æ¬º",
        "è©æ¬ºãƒ¡ãƒ¼ãƒ«": "è©æ¬ºãƒ¡ãƒ¼ãƒ«ãƒ»SMS",
        "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ": "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ",
        "ç­‹ãƒˆãƒ¬": "ç­‹ãƒˆãƒ¬",
        "ã‚µãƒ—ãƒª": "ã‚µãƒ—ãƒª",
        "ã‚¹ã‚­ãƒ³ã‚±ã‚¢": "ã‚¹ã‚­ãƒ³ã‚±ã‚¢",
        "ç¡çœ ": "ç¡çœ ",
        "ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³": "ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³",
        "ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ—ãƒª": "ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ—ãƒª",
        "ãƒ‡ãƒ¼ãƒˆ": "ãƒ‡ãƒ¼ãƒˆ",
        "å‘Šç™½": "å‘Šç™½",
        "çµå©š": "çµå©š",
        "åˆ¥ã‚Œè©±": "åˆ¥ã‚Œè©±",
        "å‹é”": "å‹é”é–¢ä¿‚",
        "LINE": "LINEãƒ»SNS",
        "ã‚²ãƒ¼ãƒ èª²é‡‘": "ã‚²ãƒ¼ãƒ èª²é‡‘",
        "æ˜ ç”»": "æ˜ ç”»ãƒ»æ¼«ç”»",
        "æ—…è¡Œ": "æ—…è¡Œ",
        "DIY": "DIY",
        "ãƒšãƒƒãƒˆ": "ãƒšãƒƒãƒˆé£¼è‚²",
    }
    
    # ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
    for keyword, topic_name in keywords_map.items():
        if keyword in title:
            if isinstance(topic_name, list):
                # è¤‡æ•°å€™è£œã®å ´åˆã¯æœ€åˆã®ã‚’è¿”ã™
                for tn in topic_name:
                    for topic in category_data["data"]:
                        if topic["topic"] == tn:
                            return topic
            elif topic_name:
                for topic in category_data["data"]:
                    if topic["topic"] == topic_name:
                        return topic
    
    # è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã‚«ãƒ†ã‚´ãƒªã®æœ€åˆã®ãƒˆãƒ”ãƒƒã‚¯ã‚’è¿”ã™
    if category_data["data"]:
        return category_data["data"][0]
    
    return None


def extract_patterns_from_facts(facts: List[str]) -> tuple:
    """
    factsã‹ã‚‰ ng_pattern, ok_pattern, loss_amount, specific_data ã‚’æŠ½å‡º
    
    Returns:
        (ng_pattern, ok_pattern, loss_amount, specific_data)
    """
    
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    ng_pattern = "çŸ¥è­˜ä¸è¶³ã§æã™ã‚‹é¸æŠ"
    ok_pattern = "ãƒ‡ãƒ¼ã‚¿ã§åˆ¤æ–­ã™ã‚‹"
    loss_amount = 50
    specific_data = facts[:6] if len(facts) >= 6 else facts + ["çŸ¥ã‚‰ãªã„ã¨æã™ã‚‹"] * (6 - len(facts))
    
    # factsã‹ã‚‰æ•°å€¤ã‚’æŠ½å‡ºã—ã¦ loss_amount ã‚’æ¨å®š
    import re
    for fact in facts:
        # å¹´é–“XXä¸‡å††, -XXä¸‡å†† ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¢ã™
        match = re.search(r'å¹´[é–“-]?([0-9.]+)ä¸‡', fact)
        if match:
            loss_amount = int(float(match.group(1)))
            break
        match = re.search(r'-([0-9.]+)ä¸‡', fact)
        if match:
            loss_amount = int(float(match.group(1)))
            break
    
    # ng_pattern ã¨ ok_pattern ã‚’ facts ã‹ã‚‰æ¨æ¸¬
    # "â†’" ã§åˆ†å‰²ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¢ã™
    for fact in facts:
        if 'â†’' in fact:
            parts = fact.split('â†’')
            if len(parts) >= 2:
                ng_part = parts[0].strip()
                ok_part = parts[1].strip()
                
                # NGãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º
                if any(keyword in ng_part for keyword in ['æ', 'å¤±æ•—', 'ä¸æ¡ç”¨', 'ãƒªã‚¹ã‚¯', 'é…å»¶', 'ç ´ç”£']):
                    # æœ€åˆã®è¦ç´ ãŒNGãƒ‘ã‚¿ãƒ¼ãƒ³
                    ng_pattern = ng_part.split(':')[0] if ':' in ng_part else ng_part
                    # 2ç•ªç›®ä»¥é™ãŒOKãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¯èƒ½æ€§
                    if any(keyword in fact for keyword in ['vs', '/', 'vs.']):
                        # å¯¾æ¯”ãƒ‘ã‚¿ãƒ¼ãƒ³
                        ok_parts = [p.strip() for p in fact.split('/') if p.strip() and not any(k in p for k in ['æ', 'å¤±æ•—', 'ä¸æ¡ç”¨'])]
                        if ok_parts:
                            ok_pattern = ok_parts[0]
                break
    
    return ng_pattern, ok_pattern, loss_amount, specific_data


def get_next_day(current_day: str) -> str:
    """æ¬¡ã®æ›œæ—¥ã‚’è¿”ã™"""
    days = ["æœˆæ›œ", "ç«æ›œ", "æ°´æ›œ", "æœ¨æ›œ", "é‡‘æ›œ", "åœŸæ›œ", "æ—¥æ›œ"]
    try:
        idx = days.index(current_day)
        return days[(idx + 1) % 7]
    except ValueError:
        return "æœˆæ›œ"


def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†: æœˆæ›œã‚«ãƒ†ã‚´ãƒªã®è¨˜äº‹ã‚’å†ç”Ÿæˆ"""
    
    print("ğŸ¨ Premium Article Generator V2 - æœ¬æ°—ãƒ¢ãƒ¼ãƒ‰èµ·å‹•")
    print("")
    print("å“è³ªåŸºæº–:")
    print("- æ–‡å­—æ•°: 1200-1500æ–‡å­—")
    print("- å…·ä½“çš„ãƒ‡ãƒ¼ã‚¿: 5å€‹ä»¥ä¸Š")
    print("- æ¥­ç•Œè£è©±: 2å€‹ä»¥ä¸Š")
    print("- æ¯”è¼ƒè¡¨: Before/Afterå·®é¡æ˜è¨˜")
    print("- ã‚¸ã‚§ã‚¤ãƒ»ã‚¨ã‚¤ãƒ–ãƒ©ãƒãƒ ç†è«–: èª­è€…ã®æå¤±ã‚’é˜²ã")
    print("")
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰
    all_data = load_data()
    article_master = load_article_master()
    
    # æœˆæ›œã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    monday_category = None
    for cat in all_data:
        if cat["category"] == "ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ãƒ»é‡‘":
            monday_category = cat
            break
    
    if not monday_category:
        print("âŒ æœˆæ›œã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return
    
    # æœˆæ›œæ—¥ã®è¨˜äº‹ã‚’æŠ½å‡º(day="æœˆæ›œ")
    monday_articles = [a for a in article_master if a["day"] == "æœˆæ›œ"]
    
    print(f"ğŸ“… æœˆæ›œã‚«ãƒ†ã‚´ãƒª: {monday_category['category']}")
    print(f"ğŸ“ è¨˜äº‹æ•°: {len(monday_articles)}")
    print(f"ğŸ’¾ ãƒ‡ãƒ¼ã‚¿æ•°: {len(monday_category['data'])} ãƒˆãƒ”ãƒƒã‚¯")
    print("")
    
    # è¨˜äº‹ã‚’1ã¤ãšã¤ç”Ÿæˆ
    generated_count = 0
    for i, article in enumerate(monday_articles):
        article_id = article["id"]
        title = article["title"]
        file_path = Path(__file__).parent.parent / "gethnote" / article["file"]
        
        # æ¬¡ã®è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
        next_title = monday_articles[(i + 1) % len(monday_articles)]["title"] if i < len(monday_articles) - 1 else None
        
        # è¨˜äº‹ç”Ÿæˆ
        content = generate_premium_article(
            article_id=article_id,
            title=title,
            day="æœˆæ›œ",
            category_data=monday_category,
            next_article_title=next_title
        )
        
        if content:
            # ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
            file_path.parent.mkdir(parents=True, exist_ok=True)
            with open(file_path, "w", encoding="utf-8") as f:
                f.write(content)
            
            print(f"âœ… [ID {article_id:3d}] {title}")
            generated_count += 1
        else:
            print(f"âš ï¸  [ID {article_id:3d}] ç”Ÿæˆå¤±æ•—: {title}")
    
    print("")
    print(f"ğŸ‰ å®Œäº†! ç”Ÿæˆè¨˜äº‹æ•°: {generated_count}/{len(monday_articles)}")
    print("")


if __name__ == "__main__":
    main()
