#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Premium Article Generator - ALL Categories (月曜-日曜 100記事)
V4ロジック: factsをそのまま表示
"""

import json
import re
from pathlib import Path
from typing import Dict, List


def find_topic_by_keywords(title: str, category_data: Dict) -> Dict:
    """
    タイトルからキーワード抽出してtopicを検索
    """
    # 全カテゴリのキーワードマッピング
    keyword_map = {
        # 月曜_ギャンブル金
        'パチ': ['パチンコ', 'パチスロ'],
        'FX': ['FX(裁量)', 'FX'],
        '節税': ['節税・税金対策'],
        '履歴書': ['履歴書・職務経歴書'],
        '昇進': ['昇進・出世'],
        'ダイエット': ['ダイエット'],
        '美容医療': ['美容医療・整形'],
        'アンチエイジング': ['アンチエイジング'],
        'LINE': ['LINE・SNS'],
        'ご近所': ['ご近所トラブル'],
        '買い物': ['買い物術'],
        '音楽': ['音楽ストリーミング'],
        '趣味グッズ': ['趣味グッズ'],
        'SNS炎上': ['SNS炎上'],
        'ポイント': ['ポイント活用'],
        
        # 火曜_ビジネスキャリア
        '競馬': ['競馬'],
        '暗号資産': ['暗号資産・仮想通貨'],
        '相続': ['相続対策'],
        '面接': ['面接対策'],
        '副業選': ['副業選び'],
        'メンタル': ['メンタルヘルス'],
        'サプリ': ['サプリメント'],
        'スキンケア': ['スキンケア'],
        'マッチング': ['マッチングアプリ'],
        '友人関係': ['友人関係'],
        '家電': ['家電購入'],
        '動画配信': ['動画配信サービス'],
        'ゲーム課金': ['ゲーム課金'],
        'デマ拡散': ['デマ拡散'],
        'クレカ': ['クレカ・電子マネー'],
        
        # 水曜_生活節約
        '不動産': ['不動産投資'],
        '生命保険': ['生命保険'],
        '退職': ['退職時期・方法'],
        '副業確': ['副業確定申告'],
        '副業バレ': ['副業バレ防止'],
        '睡眠': ['睡眠改善'],
        '歯科': ['歯科治療'],
        'ヘアケア': ['ヘアケア'],
        '婚活': ['婚活'],
        '家族': ['家族トラブル'],
        'サブスク': ['サブスク管理'],
        'ライブ': ['ライブ・コンサート'],
        '旅行予約': ['旅行予約'],
        '誹謗中傷': ['誹謗中傷対応'],
        'スマホ': ['スマホ・格安SIM'],
        
        # 木曜_社会ネット裏事情
        '住宅ローン': ['住宅ローン'],
        '電子マネー': ['電子マネー・QR決済'],
        '年収交渉': ['年収交渉'],
        '転職': ['転職エージェント'],
        'フリーランス': ['フリーランス独立'],
        '運動': ['運動・筋トレ'],
        '整体': ['整体・マッサージ'],
        '脱毛': ['脱毛'],
        '恋愛': ['恋愛相談'],
        '職場': ['職場の人間関係'],
        'ネット通販': ['ネット通販'],
        '書籍': ['書籍・電子書籍'],
        'カメラ': ['カメラ・撮影機材'],
        '個人情報': ['個人情報流出'],
        'Wi-Fi': ['Wi-Fi・ネット回線'],
        
        # 金曜_健康美容
        'NISA': ['NISA'],
        'ふるさと': ['ふるさと納税'],
        '起業': ['起業準備'],
        '転職面': ['転職面接'],
        'リモート': ['リモートワーク'],
        '姿勢': ['姿勢改善'],
        '病院': ['病院選び'],
        'ネイル': ['ネイル・ハンドケア'],
        '告白': ['告白・プロポーズ'],
        '親戚': ['親戚付き合い'],
        'ふるさと納税': ['ふるさと納税'],
        '映画': ['映画・ドラマ鑑賞'],
        'アウトドア': ['アウトドア用品'],
        'アカウント': ['アカウント乗っ取り'],
        'パソコン': ['パソコン購入'],
        
        # 土曜_恋愛人間関係
        'iDeCo': ['iDeCo'],
        '金融詐欺': ['金融詐欺'],
        'フリーランス税': ['フリーランス税務'],
        '退職交渉': ['退職交渉'],
        '独立': ['独立・起業'],
        'ストレス': ['ストレス対策'],
        '健康診断': ['健康診断'],
        'ファッション': ['ファッション'],
        '結婚': ['結婚準備'],
        '上司': ['上司との関係'],
        '保険': ['保険見直し'],
        'アニメ': ['アニメ・マンガ'],
        'DIY': ['DIY・ハンドメイド'],
        'ネット詐欺': ['ネット詐欺'],
        '銀行': ['銀行・証券口座'],
        
        # 日曜_趣味遊び
        '投資信託': ['投資信託'],
        '老後': ['老後資金'],
        '法人': ['法人設立'],
        '引き継ぎ': ['引き継ぎ'],
        '会社設立': ['会社設立'],
        '腰痛': ['腰痛・肩こり'],
        'かかりつけ': ['かかりつけ医'],
        'メイク': ['メイク'],
        '同棲': ['同棲・半同棲'],
        '部下': ['部下との関係'],
        'ローン': ['ローン・借金'],
        'スポーツ': ['スポーツ観戦'],
        'ペット': ['ペット用品'],
        'フィッシング': ['フィッシング詐欺'],
        '資産': ['資産管理アプリ']
    }
    
    # タイトルからキーワード抽出
    for keyword, topics in keyword_map.items():
        if keyword in title:
            # category_dataからtopicを検索
            for item in category_data.get('data', []):
                if item.get('topic') in topics:
                    return item
    
    # デフォルト (最初のtopic)
    if category_data.get('data'):
        return category_data['data'][0]
    
    return {'topic': 'Unknown', 'facts': []}


def extract_loss_amount(facts: List[str]) -> int:
    """
    factsから損失額を抽出
    """
    for fact in facts:
        match = re.search(r'[-年間]+([0-9]+)万', fact)
        if match:
            return int(match.group(1))
    return 100


def generate_article(
    article_id: int,
    title: str,
    day: str,
    category_data: Dict,
    next_title: str = None
) -> str:
    """
    記事生成 (V4ロジック: factsそのまま表示)
    """
    topic_data = find_topic_by_keywords(title, category_data)
    facts = topic_data.get('facts', [])
    
    if not facts:
        facts = ['データ収集中'] * 5
    
    loss_amount = extract_loss_amount(facts)
    
    while len(facts) < 5:
        facts.append(facts[0] if facts else 'データ収集中')
    
    article = f"""# {title}

---

## 【無料部分】タバコ1本吸う間に読める

俺は昔、知らずに年間{loss_amount}万円損してた。

でもある**3つのポイント**に気づいただけで、今は損しなくなった。

その3つのうち、**1つだけ無料で公開する**。

---

## ポイント① あなたの知らない損失

**理由:** 知識がないと確実に損する

実際のデータを見てくれ↓

### あなたが気づいていない損失

"""
    
    for i, fact in enumerate(facts[:5], 1):
        article += f"**{i}.** {fact}\n\n"
    
    article += f"""
つまり、知らないだけで**年間{loss_amount}万円以上損する**可能性がある。

---

俺も昔は知らなくて大損した。

でも「データを知って行動を変える」だけで人生変わった。マジで。

---

### お前も当てはまってないか？

・業者/他人の言いなり
・比較検討しない
・最新情報を知らない

全部**カモフラグ**だぞ。

---

## 残り2つも知りたい？

無料で公開したのは**ポイント①だけ**。

残り2つのポイントを知れば、**年間{loss_amount}万円は確実に守れる**。

---

タバコ1箱分(300円)で読める。

300円ケチって今年も{loss_amount}万円損するか、300円払って守るか。

お前次第。

---

---

## 【有料部分】¥300

おう、300円払ったな。賢い選択だ。

ここから先は本当にヤバい裏側を晒す。

---

## なんでこんなに損する奴が多いのか

{title}の裏事情、知ってるか?

### 業界が隠したがる事実

"""
    
    if len(facts) > 1:
        article += f"**{facts[1]}**\n\n"
    if len(facts) > 2:
        article += f"**{facts[2]}**\n\n"
    
    article += """
業者・インフルエンサー・詐欺師は、お前が無知なまま損してくれた方が儲かる。
だから公式には絶対に教えない情報がある。

「お客様第一」とか言いながら、実は手数料ボッタクリ商品を売りつけてる。

ガチでエグい。

---

## じゃあどうすればいいのか

### ステップ1: **損失パターンを避ける**

以下のパターンは確実に損する↓

"""
    
    article += f"❌ **パターン①:** {facts[0]}\n\n"
    if len(facts) > 3:
        article += f"❌ **パターン②:** {facts[3]}\n\n"
    if len(facts) > 4:
        article += f"❌ **パターン③:** {facts[4]}\n\n"
    
    article += f"""
これらを避けるだけで**年間{loss_amount}万円は守れる**。マジで。

---

### ステップ2: **正しい行動を取る**

逆に損しない行動はここだ↓

⭕ **行動①: データを知る**
→ 上記の損失パターンを全部頭に入れる

⭕ **行動②: 3社以上比較する**
→ 面倒くさがらずに比較。それだけで半額になることも

⭕ **行動③: 最新情報を常にチェック**
→ 制度・トレンドは毎年変わる。古い知識は損する

この3つを守れば**年間{loss_amount}万円は確実に守れる**。
俺も実際に試して損しなくなった。

---

### ステップ3: **プロが使う裏ワザ**

損しない奴・成功してる奴は全員これやってる。

**1. 業者の提案を鵜呑みにしない**
→ セカンドオピニオン必須。専門家・経験者に相談

**2. キャンペーン・特典・裏技を徹底活用**
→ 時期・方法によっては数万~数十万円の差がつく

**3. 定期的に見直す(年1回は必須)**
→ 契約・習慣したら終わりじゃない。毎年最適化しろ

この3つを満たせばさらに年{int(loss_amount * 0.5)}万円浮く。
俺はこれで年間トータル{int(loss_amount * 1.5)}万円守ってる。ガチで。

---

## 実際どれくらい得するのか

| 項目 | 損失額 |
|------|--------|
"""
    
    for i, fact in enumerate(facts[:3], 1):
        short_fact = fact[:30] + '...' if len(fact) > 30 else fact
        article += f"| {short_fact} | 確認推奨 |\n"
    
    article += f"""| **年間合計** | **約{loss_amount}万円の損失リスク** |

つまり、**年間{loss_amount}万円は確実に守れる可能性がある**。

守った金でタバコ買うもよし、次の投資に回すもよし、貯金して少しマシな生活するもよし。お前の自由だ。

---

## 最後に

周りのバカどもは知らずに損し続けてる。

でもこれを読んだお前は違う。

**年間{loss_amount}万円守る知識**を手に入れた。

あとは行動するだけ。

---

300円払ったのはデカい投資だ。

今年は絶対に損するな。

---
"""
    
    if next_title:
        article += f"""
## 次回予告

次は「{next_title}」で、さらにヤバい裏側を暴露する。

また300円で読める。楽しみに待ってろ。

---
"""
    
    return article


def main():
    """
    メイン処理: 全7カテゴリ100記事生成
    """
    print("🔥 Premium Article Generator - ALL 100 Articles")
    print()
    
    # データ読み込み
    data_file = Path(__file__).parent / 'data_collection_output.json'
    with open(data_file, 'r', encoding='utf-8') as f:
        all_data = json.load(f)
    
    # 全記事定義 (ID, 曜日, タイトル, カテゴリindex)
    # カテゴリ0: ギャンブル・金
    # カテゴリ1: ビジネス・キャリア
    # カテゴリ2: 生活・節約
    # カテゴリ3: 社会・ネット裏事情
    # カテゴリ4: 健康・美容
    # カテゴリ5: 恋愛・人間関係
    # カテゴリ6: 趣味・遊び
    
    articles = [
        # 月曜_ギャンブル金 (category 0)
        (1, '月曜', '【パチで負ける台の見分け方】', 0),
        (2, '月曜', '【競馬で確実に負ける買い方】', 0),
        (8, '月曜', '【FXで絶対やってはいけないこと】', 0),
        (9, '月曜', '【暗号資産で損する買い方】', 0),
        (15, '月曜', '【節税で逆に損する方法】', 0),
        (22, '月曜', '【クレカ・電子マネーで損する使い方】', 0),
        
        # 火曜_ビジネスキャリア (category 1)
        (16, '火曜', '【面接で絶対落ちる回答】', 1),
        (23, '火曜', '【履歴書・職務経歴書で損する書き方】', 1),
        (29, '火曜', '【昇進で損する働き方】', 1),
        (30, '火曜', '【副業選びで失敗する選択】', 1),
        (36, '火曜', '【起業準備で失敗する準備不足】', 1),
        (43, '火曜', '【フリーランス独立で失敗する準備】', 1),
        
        # 水曜_生活節約 (category 2)
        (3, '水曜', '【不動産投資で確実に失敗する物件選び】', 2),
        (10, '水曜', '【生命保険で損する入り方】', 2),
        (17, '水曜', '【退職で損する時期・方法】', 2),
        (24, '水曜', '【副業確定申告で税務調査される申告方法】', 2),
        (31, '水曜', '【副業バレで会社にバレる失敗】', 2),
        (38, '水曜', '【睡眠で疲れが取れない習慣】', 2),
        (45, '水曜', '【歯科治療で後悔する選択】', 2),
        (52, '水曜', '【ヘアケアで髪が傷む方法】', 2),
        (59, '水曜', '【婚活で結婚できない行動】', 2),
        (66, '水曜', '【家族トラブルで関係悪化する対応】', 2),
        (73, '水曜', '【サブスク管理で無駄金を払う方法】', 2),
        (80, '水曜', '【ライブ・コンサートで損するチケット購入】', 2),
        (87, '水曜', '【旅行予約で高く払う予約方法】', 2),
        (94, '水曜', '【誹謗中傷で訴えられる書き込み】', 2),
        
        # 木曜_社会ネット裏事情 (category 3)
        (4, '木曜', '【住宅ローンで損する組み方】', 3),
        (11, '木曜', '【電子マネー・QR決済で損する使い方】', 3),
        (18, '木曜', '【年収交渉で失敗する交渉術】', 3),
        (25, '木曜', '【転職エージェントで失敗する使い方】', 3),
        (32, '木曜', '【フリーランス独立で失敗する準備】', 3),
        (39, '木曜', '【運動・筋トレで怪我する方法】', 3),
        (46, '木曜', '【整体・マッサージで悪化する選び方】', 3),
        (53, '木曜', '【脱毛で後悔するサロン選び】', 3),
        (60, '木曜', '【恋愛相談で関係が壊れる相談先】', 3),
        (67, '木曜', '【職場の人間関係で孤立する行動】', 3),
        (74, '木曜', '【ネット通販で詐欺に遭う買い方】', 3),
        (81, '木曜', '【書籍・電子書籍で損する買い方】', 3),
        (88, '木曜', '【カメラ・撮影機材で損する選び方】', 3),
        (95, '木曜', '【個人情報流出で被害が拡大する対応】', 3),
        
        # 金曜_健康美容 (category 4)
        (5, '金曜', '【NISAで損する銘柄選び】', 4),
        (12, '金曜', '【ふるさと納税で損する選び方】', 4),
        (19, '金曜', '【起業準備で失敗する準備不足】', 4),
        (26, '金曜', '【転職面接で落ちる自己PR】', 4),
        (33, '金曜', '【リモートワークで評価が下がる働き方】', 4),
        (40, '金曜', '【姿勢改善で逆に悪化する方法】', 4),
        (47, '金曜', '【病院選びで後悔する選択】', 4),
        (54, '金曜', '【ネイル・ハンドケアで爪が傷む方法】', 4),
        (61, '金曜', '【告白・プロポーズで断られる方法】', 4),
        (68, '金曜', '【親戚付き合いで揉める対応】', 4),
        (75, '金曜', '【ふるさと納税で税金が戻らない申告ミス】', 4),
        (82, '金曜', '【映画・ドラマ鑑賞で損するサービス選び】', 4),
        (89, '金曜', '【アウトドア用品で損する買い方】', 4),
        (96, '金曜', '【アカウント乗っ取りで被害拡大する対応】', 4),
        
        # 土曜_恋愛人間関係 (category 5)
        (6, '土曜', '【iDeCoで損する運用方法】', 5),
        (13, '土曜', '【金融詐欺に騙される人の特徴】', 5),
        (20, '土曜', '【フリーランス税務で税務調査される申告】', 5),
        (27, '土曜', '【退職交渉で損する辞め方】', 5),
        (34, '土曜', '【独立・起業で失敗する事業計画】', 5),
        (41, '土曜', '【ストレス対策で悪化する方法】', 5),
        (48, '土曜', '【健康診断で見逃される検査項目】', 5),
        (55, '土曜', '【ファッションで損する服選び】', 5),
        (62, '土曜', '【結婚準備で揉める準備不足】', 5),
        (69, '土曜', '【上司との関係で評価が下がる行動】', 5),
        (76, '土曜', '【保険見直しで損する見直し方】', 5),
        (83, '土曜', '【アニメ・マンガで損する買い方】', 5),
        (90, '土曜', '【DIY・ハンドメイドで失敗する材料選び】', 5),
        (97, '土曜', '【ネット詐欺に騙される危険なクリック】', 5),
        
        # 日曜_趣味遊び (category 6)
        (7, '日曜', '【投資信託で損する選び方】', 6),
        (14, '日曜', '【老後資金で失敗する準備不足】', 6),
        (21, '日曜', '【法人設立で損する設立方法】', 6),
        (28, '日曜', '【引き継ぎで恨まれる引き継ぎ方】', 6),
        (35, '日曜', '【会社設立で失敗する資本金設定】', 6),
        (42, '日曜', '【腰痛・肩こりで悪化する対処法】', 6),
        (49, '日曜', '【かかりつけ医で後悔する選び方】', 6),
        (56, '日曜', '【メイクで老けて見える方法】', 6),
        (63, '日曜', '【同棲・半同棲で破局する始め方】', 6),
        (70, '日曜', '【部下との関係で信頼を失う行動】', 6),
        (77, '日曜', '【ローン・借金で破産する借り方】', 6),
        (84, '日曜', '【スポーツ観戦で損するチケット購入】', 6),
        (91, '日曜', '【ペット用品で損する買い方】', 6),
        (98, '日曜', '【フィッシング詐欺に引っかかる危険なメール】', 6),
    ]
    
    # カテゴリ別フォルダ名
    category_folders = {
        0: '月曜_ギャンブル金',
        1: '火曜_ビジネスキャリア',
        2: '水曜_生活節約',
        3: '木曜_社会ネット裏事情',
        4: '金曜_健康美容',
        5: '土曜_恋愛人間関係',
        6: '日曜_趣味遊び'
    }
    
    # 出力ベースディレクトリ
    base_dir = Path(__file__).parent.parent / 'gethnote' / 'drafts'
    
    print(f"📝 全記事数: {len(articles)}")
    print(f"📁 出力先: {base_dir}")
    print()
    
    # 記事生成
    for i, (article_id, day, title, cat_idx) in enumerate(articles):
        category_data = all_data[cat_idx]
        next_title = articles[i + 1][2] if i + 1 < len(articles) else None
        
        article = generate_article(
            article_id=article_id,
            title=title,
            day=day,
            category_data=category_data,
            next_title=next_title
        )
        
        # フォルダ作成
        folder_name = category_folders[cat_idx]
        output_dir = base_dir / folder_name
        output_dir.mkdir(parents=True, exist_ok=True)
        
        # ファイル保存
        filename = f"{article_id:03d}_{title.replace('【', '').replace('】', '')}.md"
        filepath = output_dir / filename
        
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(article)
        
        char_count = len(article)
        print(f"✅ [{day}] ID {article_id:3d} {title[:30]}... ({char_count}文字)")
    
    print()
    print(f"🎉 完了! 全 {len(articles)} 記事生成完了")
    print()
    print("📂 生成されたフォルダ:")
    for folder in category_folders.values():
        print(f"  - {folder}/")


if __name__ == '__main__':
    main()
