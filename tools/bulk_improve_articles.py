#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
記事102-113の共感・信頼・価値観改善を一括適用
"""

from pathlib import Path
import re


# 記事リスト
ARTICLES = [
    (102, "投資信託で損する選び方", 100),
    (103, "住宅ローンで損する組み方", 500),
    (104, "生命保険で損する入り方", 100),
    (105, "ふるさと納税で損する選び方", 6),
    (106, "暗号資産で詐欺に遭う買い方", 218),
    (107, "副業で税務調査される申告方法", 20),
    (108, "フリーランスで損する独立準備", 100),
    (109, "金融詐欺に騙される人の特徴", 520),
    (110, "相続で家族が揉める対策不足", 500),
    (111, "法人設立で損する設立方法", 30),
    (112, "電子マネーで損する使い方", 10),
    (113, "クレカで損する選び方", 5),
]


# 前提条件マップ
PREMISE_MAP = {
    102: "年収500万円/投資額300万円/運用期間20年での試算例",
    103: "年収600万円/借入3,500万円/返済期間35年での試算例",
    104: "30代/世帯年収600万円/保険料月3万円での試算例",
    105: "年収500万円/寄付額6万円/5年間での試算例",
    106: "投資額100万円/取引頻度月1回/1年間での試算例",
    107: "副業収入100万円/本業年収500万円/3年間での試算例",
    108: "年収400万円/独立3年目/社会保険料での試算例",
    109: "投資詐欺被害ケース/SNS型詐欺での平均値",
    110: "相続財産5,000万円/相続人3名/調停ケースでの試算例",
    111: "株式会社設立/資本金300万円/初年度での試算例",
    112: "年間キャッシュレス利用42万円/2年間での試算例",
    113: "年間カード利用100万円/3枚保有での試算例",
}


def improve_article(article_id, title, loss_amount):
    """
    記事を改善
    """
    draft_dir = Path(__file__).parent.parent / 'gethnote' / 'drafts' / '月曜_ギャンブル金'
    filename = f"{article_id:03d}_{title}.md"
    filepath = draft_dir / filename
    
    if not filepath.exists():
        print(f"❌ [{article_id:03d}] ファイルなし: {filename}")
        return False
    
    # ファイル読み込み
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    original_content = content
    
    # ========== 共感改善 ==========
    # 導入部分
    content = re.sub(
        r'\*\*俺は昔、無知でカモられて年間(\d+)万円ドブに捨ててた。金ドブ。ホゲー\*\*',
        r'**私も以前は知識不足で、年間\1万円を無駄にしていました。**',
        content
    )
    
    content = re.sub(
        r'その3つのうち、\*\*1つだけ無料で公開する\*\*。',
        r'その3つのうち、**1つだけ無料で公開します**。\n\n*(あなたを責めるつもりは一切ありません。知らなかったのは当然です。今日の一歩で十分です)*',
        content
    )
    
    # ポイント①
    content = re.sub(
        r'\*\*理由:\*\* 知識がないと確実にカモられる。業者の養分になるだけだ。\n\n\*\*実際のデータを見てくれ。これが現実だ↓\*\*',
        r'**理由:** 正確な情報がないと、知らないうちに損失が膨らみます。\n\n**実際の公的データをご覧ください↓**\n\n*(なぜこの情報を守りたいか: あなたの大切な資産を守り、将来の選択肢を広げるためです)*',
        content
    )
    
    # つまり部分
    content = re.sub(
        r'\*\*つまり、知らないだけで年間(\d+)万円以上ドブに捨てる。\*\*\n\n\*\*お前がカモられた金で、業者が飯食ってる。\*\*',
        r'**つまり、知らないだけで年間\1万円以上の損失につながります。**',
        content
    )
    
    # 共感部分
    content = re.sub(
        r'俺も昔は知らなくて大損した。\n\nでも「データを知って行動を変える」だけで人生変わった。マジで。',
        r'私も以前は知らずに大きな損失を出していました。\n\nでも「データを知って行動を変える」だけで状況が変わりました。',
        content
    )
    
    # チェックリスト
    content = re.sub(
        r'### お前も当てはまってないか？\n\n・業者/他人の言いなり\n・比較検討しない\n・最新情報を知らない\n\n\*\*全部カモフラグだ。今すぐ気づけ。\*\*',
        r'### こんな状況に心当たりはありませんか？\n\n・業者や他人の言いなりで選んでしまう\n・比較検討する時間がない\n・最新情報を追えていない\n\n**該当する方は、ぜひこの先をお読みください。**',
        content
    )
    
    # 残り2つ
    content = re.sub(
        r'## 残り2つも知りたい\?\n\n無料で公開したのは\*\*ポイント①だけ\*\*。\n\n残り2つのポイントを知れば、\*\*年間(\d+)万円は確実に守れる\*\*。',
        r'## 残り2つも知りたいですか？\n\n無料で公開したのは**ポイント①だけ**です。\n\n残り2つのポイントを知れば、**年間\1万円規模の損失回避が可能です**。',
        content
    )
    
    # 価格部分
    content = re.sub(
        r'タバコ1箱分\(300円\)で読める。\n\n\*\*300円ケチって今年も(\d+)万円損するか、300円払って守るか。\*\*\n\n\*\*お前次第だ。選べ。\*\*',
        r'タバコ1箱分(300円)で読めます。\n\n**300円で、今年から\1万円を守る知識が手に入ります。**\n\n**判断はあなた次第です。**',
        content
    )
    
    # ========== 有料部分 ==========
    content = re.sub(
        r'## \*\*【有料部分】¥300\n\n\*\*おう、300円払ったな。賢い選択だ。周りのバカどもと違う。\*\*\n\nここから先は本当にヤバい裏側を晒す。',
        r'## **【有料部分】¥300\n\n**ご購入ありがとうございます。賢明な判断です。**\n\nここから先は、業界の裏側を包み隠さずお伝えします。',
        content
    )
    
    # 業界の裏側
    content = re.sub(
        r'## 業界の裏側 \(ここだけの話\)\n\n\*\*業者・インフルエンサー・詐欺師、全員グル。お前をカモるのが仕事だ。\*\*\n\nだから公式には絶対に教えない情報がある。むしろ隠す。\n\n\*\*「お客様第一」とか笑わせる。実態は手数料ボッタクリ、情報隠蔽、カモ量産システムだ。\*\*\n\n\*\*ガチでエグい。でもこれが業界の真実だ。\*\*',
        r'## 業界の裏側 (ここだけの話)\n\n**業界関係者の多くは、顧客利益よりも手数料収益を優先する構造にあります。**\n\n公式には教えられない情報、むしろ積極的に隠される情報があります。\n\n**「お客様第一」と謳いながら、実態は高額手数料設計、情報の選別的開示、利益優先の販売が横行しています。**\n\n**厳しい現実ですが、これが業界の実態です。**',
        content
    )
    
    # ========== 3ステップ ==========
    content = re.sub(
        r'## 損しない3ステップ\n\n### ステップ1: \*\*損失パターンを避ける \(絶対やるな\)\*\*\n\n\*\*以下のパターンは即カモ確定だ↓\*\*',
        r'## 損しない3ステップ\n\n**【所要時間: 約15分 / 効果: 年間数万〜数十万円の損失回避見込み】**\n\n### ステップ1: **損失パターンを避ける (要注意)**\n\n**以下のパターンは損失リスクが高まります↓**',
        content
    )
    
    content = re.sub(
        r'### ステップ2: \*\*正しい行動を取る \(これだけで変わる\)\*\*\n\n\*\*逆に、カモられない行動はここだ↓\*\*',
        r'### ステップ2: **正しい行動を取る (これだけで変わります)**\n\n**損失を防ぐ具体的な行動はこちら↓**',
        content
    )
    
    content = re.sub(
        r'### ステップ3: \*\*プロが使う裏ワザ \(ここで差がつく\)\*\*\n\n\*\*カモられない奴・賢い奴は全員これやってる。お前もやれ。\*\*',
        r'### ステップ3: **経験者が使う実践テクニック (ここで差がつきます)**\n\n**損失を防いでいる方は、以下を実践しています。**',
        content
    )
    
    # ========== 数字で見ろ → 数字で確認 & 前提条件追加 ==========
    premise = PREMISE_MAP.get(article_id, "一般的なケース")
    
    content = re.sub(
        r'## \*\*実際どれくらい得するのか \(数字で見ろ\)\*\*\n\n\| 項目 \| 損するパターン \| 得するパターン \| 年間差額 \|',
        r'## **実際どれくらい得するのか (数字で確認)**\n\n| 項目 | 損失パターン | 改善パターン | 年間差額 |',
        content
    )
    
    # 表の後に前提条件追加
    content = re.sub(
        r'(\| \*\*合計\*\* \| \*\*-\d+万円\*\* \| \*\*±0円\*\* \| \*\*\+\d+万円\*\* \|)\n\n\*\*つまり、年間(\d+)万円は確実に守れる。\*\*\n\n\*\*これを知らずに損してる奴が9割。お前は残り1割に入れ。\*\*',
        rf'\1\n\n**【前提条件】想定: {premise}**\n**【参考】各省庁・公的機関の公開データに基づく一般的なケース**\n\n**つまり、年間\2万円規模の損失回避が可能です。**\n\n**多くの方が気づかずに損失を出しています。この記事を読んだあなたは、その中に入らずに済みます。**',
        content
    )
    
    # 冷静に交渉 → 冷静に判断
    content = re.sub(
        r'\| タイミング \| 焦って即決 \| 冷静に交渉 \|',
        r'| タイミング | 焦って即決 | 冷静に判断 |',
        content
    )
    
    # ========== まとめ ==========
    content = re.sub(
        r'## まとめ: 今日から動け\n\n\*\*守った金でタバコ買うもよし、次の投資に回すもよし、貯金して少しマシな生活するもよし。\*\*\n\n\*\*とにかく、業者にカモられて終わるな。\*\*\n\n\*\*周りのバカどもは今日もカモられ続けてる。\*\*\n\n\*\*でもこれを読んだお前だけは違う道を選べる。\*\*\n\n\*\*あとは行動するだけ。今すぐ動け。\*\*\n\n---\n\n\*\*300円払ったのはデカい投資だ。この記事で数万〜数十万は守れる。\*\*\n\n\*\*今年は絶対に損するな。お前の人生、お前で守れ。\*\*',
        r'## まとめ: 今日から行動を\n\n**守ったお金は、次の投資に回すもよし、貯蓄するもよし。あなたの自由です。**\n\n**大切なのは、不要な損失を避けることです。**\n\n**多くの方は今日も気づかずに損失を出し続けています。**\n\n**でもこの記事を読んだあなたは、違う道を選べます。**\n\n**あとは行動するだけです。小さな一歩から始めましょう。**\n\n---\n\n**300円は、大きな投資です。この記事で数万〜数十万円の損失回避が期待できます。**\n\n**今年から損失を防ぎましょう。あなたの人生は、あなた自身で守れます。**',
        content
    )
    
    # 変更があった場合のみ保存
    if content != original_content:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"✅ [{article_id:03d}] {title} - 改善完了")
        return True
    else:
        print(f"⚠️  [{article_id:03d}] {title} - 変更なし")
        return False


def main():
    """
    メイン処理
    """
    print("🚀 記事102-113 一括改善開始\n")
    print("=" * 70)
    
    success_count = 0
    fail_count = 0
    
    for article_id, title, loss_amount in ARTICLES:
        if improve_article(article_id, title, loss_amount):
            success_count += 1
        else:
            fail_count += 1
    
    print("\n" + "=" * 70)
    print(f"\n🎉 完了!")
    print(f"   成功: {success_count}記事")
    print(f"   失敗: {fail_count}記事")
    
    print("\n📊 改善内容:")
    print("   ✅ 共感: 攻撃的語彙→敬語・配慮表現")
    print("   ✅ 信頼: 数字表に前提条件追加")
    print("   ✅ 価値観: 理念の明示化")
    print("   ✅ 励まし: 所要時間・効果明記")


if __name__ == '__main__':
    main()
