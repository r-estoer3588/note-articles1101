services:
  n8n:
    image: n8nio/n8n:1.117.3
    container_name: n8n-notes-organizer
    restart: always
    ports:
      - "5678:5678"
    environment:
      # åŸºæœ¬èªè¨¼(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚)
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=change_this_password_123
      
      # ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
      - GENERIC_TIMEZONE=Asia/Tokyo
      - TZ=Asia/Tokyo
      
      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
      - N8N_SECURE_COOKIE=false
      
      # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
      - EXECUTIONS_PROCESS=main
      - EXECUTIONS_MODE=regular
      
      # ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
      - N8N_LOG_LEVEL=info
      
      # OpenAI API ã‚­ãƒ¼ï¼ˆç’°å¢ƒå¤‰æ•°çµŒç”±ã§ Code ãƒãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      # ğŸ”‘ é‡è¦: n8nã®å…¨è¨­å®šã‚’æ°¸ç¶šåŒ–
      # ã“ã“ã«ä»¥ä¸‹ãŒä¿å­˜ã•ã‚Œã‚‹:
      # - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
      # - Credentials (API ã‚­ãƒ¼)
      # - å®Ÿè¡Œå±¥æ­´
      # - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
      - n8n_data:/home/node/.n8n

      # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãƒã‚¦ãƒ³ãƒˆï¼ˆbindæŒ‡å®šãƒ»æ›¸ãè¾¼ã¿å¯ï¼‰
      - type: bind
        source: C:/Notes
        target: /notes
        read_only: false
      
    networks:
      - n8n-network
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯(ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã ãŒæ¨å¥¨)
    healthcheck:
      test: ["CMD-SHELL", "wget --spider -q http://localhost:5678/healthz || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  # ğŸ”’ æ°¸ç¶šåŒ–ãƒœãƒªãƒ¥ãƒ¼ãƒ 
  # ã“ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤ã—ãªã„é™ã‚Šã€è¨­å®šã¯æ°¸ä¹…ã«ä¿å­˜ã•ã‚Œã‚‹
  n8n_data:
    driver: local

networks:
  n8n-network:
    driver: bridge
