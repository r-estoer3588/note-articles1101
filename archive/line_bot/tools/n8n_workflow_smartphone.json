{
  "name": "ãƒ›ã‚²ãƒ¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ã‚¹ãƒãƒ›ç‰ˆ",
  "nodes": [
    {
      "parameters": {
        "path": "line-hogey",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "LINE Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "webhookId": "YOUR_WEBHOOK_ID"
    },
    {
      "parameters": {
        "functionCode": "// LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰è§£æ\nconst event = $input.item.json.events[0];\nconst text = event.message.text;\nconst replyToken = event.replyToken;\nconst userId = event.source.userId;\n\n// èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰\nconst allowedUsers = ['YOUR_LINE_USER_ID'];\nif (!allowedUsers.includes(userId)) {\n  return {\n    json: {\n      error: 'Unauthorized',\n      replyToken: replyToken,\n      message: 'èªè¨¼ã‚¨ãƒ©ãƒ¼ï¼šã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ä½¿ç”¨ã§ãã¾ã›ã‚“'\n    }\n  };\n}\n\n// ã‚³ãƒãƒ³ãƒ‰è§£æ\nconst parts = text.trim().split(/\\s+/);\nconst command = parts[0];\n\nlet result = {\n  command: command,\n  replyToken: replyToken,\n  userId: userId\n};\n\nswitch(command) {\n  case 'ç”Ÿæˆ':\n    result.count = parseInt(parts[1]) || 5;\n    result.theme = parts.slice(2).join(' ') || 'äººç”Ÿé€†è»¢';\n    result.type = 'buzz';\n    break;\n    \n  case 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼':\n    result.theme = parts.slice(1).join(' ') || 'åœæ»ã‹ã‚‰ã®é€†è»¢';\n    result.type = 'trilogy';\n    break;\n    \n  case 'å­¦ç¿’':\n    result.type = 'learn';\n    break;\n    \n  case 'ä»Šæ—¥':\n    const themes = {\n      0: 'æ™‚é–“ã®ä½¿ã„æ–¹',\n      1: 'ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ä¾å­˜',\n      2: 'ãƒ–ãƒ©ãƒƒã‚¯ä¼æ¥­',\n      3: 'ç„¡é§„é£ã„',\n      4: 'SNSä¾å­˜',\n      5: 'ç–²åŠ´',\n      6: 'äººé–“é–¢ä¿‚'\n    };\n    const today = new Date().getDay();\n    result.theme = themes[today];\n    result.count = parseInt(parts[1]) || 3;\n    result.type = 'buzz';\n    break;\n    \n  case 'çŠ¶æ…‹':\n    result.type = 'status';\n    break;\n    \n  default:\n    result.error = 'Unknown command';\n    result.message = 'ä½¿ã„æ–¹:\\nç”Ÿæˆ [ä»¶æ•°] [ãƒ†ãƒ¼ãƒ]\\nã‚¹ãƒˆãƒ¼ãƒªãƒ¼ [ãƒ†ãƒ¼ãƒ]\\nå­¦ç¿’\\nä»Šæ—¥ [ä»¶æ•°]\\nçŠ¶æ…‹';\n}\n\nreturn { json: result };"
      },
      "name": "ã‚³ãƒãƒ³ãƒ‰è§£æ",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.error }}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "name": "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.type }}",
              "value2": "buzz"
            }
          ]
        }
      },
      "name": "ã‚³ãƒãƒ³ãƒ‰åˆ†å²",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [850, 200],
      "parameters": {
        "mode": "expression",
        "output": "multiple",
        "rules": {
          "rules": [
            {
              "operation": "equal",
              "value1": "={{ $json.type }}",
              "value2": "buzz"
            },
            {
              "operation": "equal",
              "value1": "={{ $json.type }}",
              "value2": "trilogy"
            },
            {
              "operation": "equal",
              "value1": "={{ $json.type }}",
              "value2": "learn"
            }
          ]
        }
      }
    },
    {
      "parameters": {
        "command": "python",
        "arguments": "c:\\Repos\\note-articles\\tools\\hogey_algorithm.py --theme \"={{ $json.theme }}\" --count {{ $json.count }} --json"
      },
      "name": "ãƒã‚ºæŠ•ç¨¿ç”Ÿæˆ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1050, 100]
    },
    {
      "parameters": {
        "command": "python",
        "arguments": "c:\\Repos\\note-articles\\tools\\hogey_algorithm.py --type trilogy --theme \"={{ $json.theme }}\" --json"
      },
      "name": "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”Ÿæˆ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1050, 250]
    },
    {
      "parameters": {
        "command": "python",
        "arguments": "c:\\Repos\\note-articles\\tools\\hogey_algorithm.py --learn --my-posts c:\\Repos\\note-articles\\tools\\my_posts.csv --bench-posts c:\\Repos\\note-articles\\tools\\bench_posts.csv"
      },
      "name": "å­¦ç¿’å®Ÿè¡Œ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "functionCode": "// Pythonå‡ºåŠ›ã‚’ãƒ‘ãƒ¼ã‚¹\nconst output = $input.item.json.stdout;\nconst posts = JSON.parse(output);\n\n// æœ€åˆã®æŠ•ç¨¿ã‚’å–ã‚Šå‡ºã™\nconst firstPost = Array.isArray(posts) ? posts[0] : posts.posts[0];\n\nreturn {\n  json: {\n    ...firstPost,\n    replyToken: $node[\"ã‚³ãƒãƒ³ãƒ‰è§£æ\"].json.replyToken,\n    allPosts: posts,\n    currentIndex: 0\n  }\n};"
      },
      "name": "çµæœãƒ‘ãƒ¼ã‚¹",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1250, 200]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "replyToken": "={{ $json.replyToken }}",
        "message": "ğŸ¶ ãƒ›ã‚²ãƒ¼æŠ•ç¨¿ç”Ÿæˆå®Œäº†\n\n{{ $json.text }}\n\næ•™è‚²: {{ $json.education_type }}\nãƒ†ãƒ¼ãƒ: {{ $json.theme }}",
        "additionalFields": {
          "quickReply": {
            "items": [
              {
                "type": "action",
                "action": {
                  "type": "postback",
                  "label": "ã“ã®æŠ•ç¨¿ã‚’Xã«æŠ•ç¨¿",
                  "data": "action=post&id={{ $json.post_id }}"
                }
              },
              {
                "type": "action",
                "action": {
                  "type": "postback",
                  "label": "æ¬¡ã®æŠ•ç¨¿ã‚’è¦‹ã‚‹",
                  "data": "action=next&index={{ $json.currentIndex + 1 }}"
                }
              },
              {
                "type": "action",
                "action": {
                  "type": "postback",
                  "label": "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜",
                  "data": "action=save"
                }
              },
              {
                "type": "action",
                "action": {
                  "type": "message",
                  "label": "ç ´æ£„",
                  "text": "ç ´æ£„"
                }
              }
            ]
          }
        }
      },
      "name": "LINEè¿”ä¿¡",
      "type": "n8n-nodes-base.line",
      "typeVersion": 1,
      "position": [1450, 200]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "reply",
        "replyToken": "={{ $json.replyToken }}",
        "message": "âŒ ã‚¨ãƒ©ãƒ¼\n\n{{ $json.message }}"
      },
      "name": "ã‚¨ãƒ©ãƒ¼è¿”ä¿¡",
      "type": "n8n-nodes-base.line",
      "typeVersion": 1,
      "position": [850, 450]
    },
    {
      "parameters": {
        "path": "line-postback",
        "responseMode": "lastNode"
      },
      "name": "LINE Postback Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 600]
    },
    {
      "parameters": {
        "functionCode": "// Postbackãƒ‡ãƒ¼ã‚¿è§£æ\nconst event = $input.item.json.events[0];\nconst data = event.postback.data;\nconst params = new URLSearchParams(data);\n\nreturn {\n  json: {\n    action: params.get('action'),\n    id: params.get('id'),\n    index: parseInt(params.get('index')) || 0,\n    replyToken: event.replyToken\n  }\n};"
      },
      "name": "Postbackè§£æ",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 600]
    },
    {
      "parameters": {
        "mode": "expression",
        "output": "multiple",
        "rules": {
          "rules": [
            {
              "operation": "equal",
              "value1": "={{ $json.action }}",
              "value2": "post"
            },
            {
              "operation": "equal",
              "value1": "={{ $json.action }}",
              "value2": "save"
            },
            {
              "operation": "equal",
              "value1": "={{ $json.action }}",
              "value2": "next"
            }
          ]
        }
      },
      "name": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†å²",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [650, 600]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": "YOUR_GOOGLE_SHEET_ID",
        "sheetName": "æŠ•ç¨¿ç®¡ç†",
        "columns": {
          "mappings": [
            {
              "column": "post_id",
              "value": "={{ $json.post_id }}"
            },
            {
              "column": "text",
              "value": "={{ $json.text }}"
            },
            {
              "column": "theme",
              "value": "={{ $json.theme }}"
            },
            {
              "column": "education_type",
              "value": "={{ $json.education_type }}"
            },
            {
              "column": "æŠ•ç¨¿",
              "value": ""
            },
            {
              "column": "scheduled_datetime",
              "value": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "name": "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¿å­˜",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [850, 700]
    },
    {
      "parameters": {
        "resource": "tweet",
        "operation": "create",
        "text": "={{ $json.text }}"
      },
      "name": "XæŠ•ç¨¿",
      "type": "n8n-nodes-base.twitter",
      "typeVersion": 2,
      "position": [850, 500]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "reply",
        "replyToken": "={{ $json.replyToken }}",
        "message": "âœ… Xã«æŠ•ç¨¿ã—ã¾ã—ãŸï¼\n\n{{ $json.text }}"
      },
      "name": "æŠ•ç¨¿å®Œäº†é€šçŸ¥",
      "type": "n8n-nodes-base.line",
      "typeVersion": 1,
      "position": [1050, 500]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "reply",
        "replyToken": "={{ $json.replyToken }}",
        "message": "ğŸ’¾ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã—ã¾ã—ãŸï¼\n\nå¾Œã§æŠ•ç¨¿ã§ãã¾ã™ã€‚"
      },
      "name": "ä¿å­˜å®Œäº†é€šçŸ¥",
      "type": "n8n-nodes-base.line",
      "typeVersion": 1,
      "position": [1050, 700]
    }
  ],
  "connections": {
    "LINE Webhook": {
      "main": [
        [
          {
            "node": "ã‚³ãƒãƒ³ãƒ‰è§£æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚³ãƒãƒ³ãƒ‰è§£æ": {
      "main": [
        [
          {
            "node": "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [
          {
            "node": "ã‚³ãƒãƒ³ãƒ‰åˆ†å²",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ã‚¨ãƒ©ãƒ¼è¿”ä¿¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚³ãƒãƒ³ãƒ‰åˆ†å²": {
      "main": [
        [
          {
            "node": "ãƒã‚ºæŠ•ç¨¿ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å­¦ç¿’å®Ÿè¡Œ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒã‚ºæŠ•ç¨¿ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "çµæœãƒ‘ãƒ¼ã‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "çµæœãƒ‘ãƒ¼ã‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "çµæœãƒ‘ãƒ¼ã‚¹": {
      "main": [
        [
          {
            "node": "LINEè¿”ä¿¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LINE Postback Webhook": {
      "main": [
        [
          {
            "node": "Postbackè§£æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postbackè§£æ": {
      "main": [
        [
          {
            "node": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†å²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ†å²": {
      "main": [
        [
          {
            "node": "XæŠ•ç¨¿",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¿å­˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "XæŠ•ç¨¿": {
      "main": [
        [
          {
            "node": "æŠ•ç¨¿å®Œäº†é€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¿å­˜": {
      "main": [
        [
          {
            "node": "ä¿å­˜å®Œäº†é€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-11-08T00:00:00.000Z",
  "versionId": "1"
}
